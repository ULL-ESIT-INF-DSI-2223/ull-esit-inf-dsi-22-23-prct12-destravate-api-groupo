<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>practica-12</title><meta name="description" content="Documentation for practica-12"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os"</script><header class="tsd-page-toolbar">
<div class="tsd-toolbar-contents container">
<div class="table-cell" id="tsd-search" data-base=".">
<div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z" fill="var(--color-text)"></path></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div>
<div class="field">
<div id="tsd-toolbar-links"></div></div>
<ul class="results">
<li class="state loading">Preparing search index...</li>
<li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">practica-12</a></div>
<div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="7" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="11" width="14" height="2" fill="var(--color-text)"></rect></svg></a></div></div></header>
<div class="container container-main">
<div class="col-8 col-content">
<div class="tsd-page-title">
<h2>practica-12</h2></div>
<div class="tsd-panel tsd-typography">
<a href="#práctica-12---destravate-api-nodeexpress" id="práctica-12---destravate-api-nodeexpress" style="color: inherit; text-decoration: none;">
  <h1>Práctica 12 - Destravate: API Node/Express</h1>
</a>
<p>Esta práctica consiste en la realización de una API REST, realizada mediante el uso de Node/Express, que nos perminte hacer las opereciones CRUD (<em>Create</em>, <em>Read</em>, <em>Update</em>, <em>Delete</em>), para registar actividades deportivas.
<br><br>Esta práctica se ha realizado en grupo por los siguientes alumnos:</p>
<ul>
<li>Pablo de la Fuente Rodríguez (<a href="mailto:alu0101336152@ull.edu.es">alu0101336152@ull.edu.es</a>)</li>
<li>José David Mur Álvarez (<a href="mailto:alu0101052168@ull.edu.es">alu0101052168@ull.edu.es</a>)</li>
<li>Carlos Pío Reyes (<a href="mailto:alu0101132945@ull.edu.es">alu0101132945@ull.edu.es</a>)
<br><br>El código fuente del proyecto se encuentra organizado en diferentes directorios y se hace uso de sintaxis ES para importar/exportar las distintas entidades.</li>
</ul>

<a href="#requisitos-del-sistema" id="requisitos-del-sistema" style="color: inherit; text-decoration: none;">
  <h2>Requisitos del sistema</h2>
</a>
<p>Para la creación de este sistema se proponen 4 elementos fundamentales: <em>Tracks</em>, Usuarios, Grupos y Retos. Para cada uno de ellos se ha creado en el directorio <em>models</em> sus respectivas interfaces y esquemas para crear el modelo que será usado en la base de datos. Cabe destacar que algunos de los elementos de información se han omitidos con el fin de evitar bucles, tal y cómo comentó el profesor, es por ello que en <em>Tracks</em> y Retos no se incluyen los Usuarios, pero sí a la inversa, para así evitar bucles.</p>

<a href="#track" id="track" style="color: inherit; text-decoration: none;">
  <h3>Track</h3>
</a>
<pre><code class="language-TypeScript"><span class="hl-0">/**</span><br/><span class="hl-0"> * Track interface for apply it in the Track schema</span><br/><span class="hl-0"> */</span><br/><span class="hl-1">export</span><span class="hl-2"> </span><span class="hl-3">interface</span><span class="hl-2"> </span><span class="hl-4">TrackDocumentInterface</span><span class="hl-2"> </span><span class="hl-3">extends</span><span class="hl-2"> </span><span class="hl-4">Document</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-5">name</span><span class="hl-2">: </span><span class="hl-4">string</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-5">startGeolocation</span><span class="hl-2">: {</span><br/><span class="hl-2">    </span><span class="hl-5">latitude</span><span class="hl-2">: </span><span class="hl-4">string</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-5">longitude</span><span class="hl-2">: </span><span class="hl-4">string</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">  </span><span class="hl-5">endGeolocation</span><span class="hl-2">: {</span><br/><span class="hl-2">    </span><span class="hl-5">latitude</span><span class="hl-2">: </span><span class="hl-4">string</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-5">longitude</span><span class="hl-2">: </span><span class="hl-4">string</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">  </span><span class="hl-5">length</span><span class="hl-2">: </span><span class="hl-4">number</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-5">unevenness</span><span class="hl-2">: </span><span class="hl-4">number</span><span class="hl-2">,  </span><br/><span class="hl-2">  </span><span class="hl-5">activity</span><span class="hl-2">: </span><span class="hl-6">&#39;bike&#39;</span><span class="hl-2"> | </span><span class="hl-6">&#39;running&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-5">rating</span><span class="hl-2">: </span><span class="hl-4">number</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Track Schema for create Track objects in the database</span><br/><span class="hl-0"> */</span><br/><span class="hl-1">export</span><span class="hl-2"> </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">TrackSchema</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Schema</span><span class="hl-2">&lt;</span><span class="hl-4">TrackDocumentInterface</span><span class="hl-2">&gt;({</span><br/><span class="hl-2">  </span><span class="hl-5">name:</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">String</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-5">unique:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-8">validate</span><span class="hl-5">:</span><span class="hl-2"> (</span><span class="hl-5">value</span><span class="hl-2">: </span><span class="hl-4">string</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">value</span><span class="hl-2">.</span><span class="hl-8">match</span><span class="hl-2">(</span><span class="hl-9">/</span><span class="hl-10">^</span><span class="hl-11">[</span><span class="hl-9">A-Z</span><span class="hl-11">]</span><span class="hl-9">/</span><span class="hl-2">)) {</span><br/><span class="hl-2">        </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Error</span><span class="hl-2">(</span><span class="hl-6">&#39;Track name must start with a capital letter&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">      } </span><span class="hl-1">else</span><span class="hl-2"> </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">validator</span><span class="hl-2">.</span><span class="hl-5">default</span><span class="hl-2">.</span><span class="hl-8">isAlphanumeric</span><span class="hl-2">(</span><span class="hl-5">value</span><span class="hl-2">.</span><span class="hl-8">replace</span><span class="hl-2">(</span><span class="hl-9">/\s/</span><span class="hl-3">g</span><span class="hl-2">, </span><span class="hl-6">&#39;&#39;</span><span class="hl-2">))) {</span><br/><span class="hl-2">        </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Error</span><span class="hl-2">(</span><span class="hl-6">&#39;Track name must contain alphanumeric characters and spaces only&#39;</span><span class="hl-2">)</span><br/><span class="hl-2">      }</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">  </span><span class="hl-5">startGeolocation:</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-5">latitude:</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">String</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">    </span><span class="hl-5">longitude:</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">String</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">  </span><span class="hl-5">endGeolocation:</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-5">latitude:</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">String</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">    </span><span class="hl-5">longitude:</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">String</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">  </span><span class="hl-5">length:</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">Number</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-8">validate</span><span class="hl-2">(</span><span class="hl-5">value</span><span class="hl-2">: </span><span class="hl-4">number</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-5">value</span><span class="hl-2"> &lt;= </span><span class="hl-12">0</span><span class="hl-2">) {</span><br/><span class="hl-2">        </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Error</span><span class="hl-2">(</span><span class="hl-6">&#39;Unevenness must be greater than 0&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">      }</span><br/><span class="hl-2">    } </span><br/><span class="hl-2">  },</span><br/><span class="hl-2">  </span><span class="hl-5">unevenness:</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">Number</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-8">validate</span><span class="hl-2">(</span><span class="hl-5">value</span><span class="hl-2">: </span><span class="hl-4">number</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-5">value</span><span class="hl-2"> &lt;= </span><span class="hl-12">0</span><span class="hl-2">) {</span><br/><span class="hl-2">        </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Error</span><span class="hl-2">(</span><span class="hl-6">&#39;Unevenness must be greater than 0&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">      }</span><br/><span class="hl-2">    } </span><br/><span class="hl-2">  },</span><br/><span class="hl-2">  </span><span class="hl-5">activity:</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">String</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-5">enum:</span><span class="hl-2"> [</span><span class="hl-6">&#39;bike&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;running&#39;</span><span class="hl-2">],</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">  </span><span class="hl-5">rating:</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">Number</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-8">validate</span><span class="hl-2">(</span><span class="hl-5">value</span><span class="hl-2">: </span><span class="hl-4">number</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-5">value</span><span class="hl-2"> &lt; </span><span class="hl-12">0</span><span class="hl-2"> || </span><span class="hl-5">value</span><span class="hl-2"> &gt; </span><span class="hl-12">10</span><span class="hl-2">) {</span><br/><span class="hl-2">        </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Error</span><span class="hl-2">(</span><span class="hl-6">&#39;Rating must be greater than or equal to 0 and lower than or equal to 10&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">      }</span><br/><span class="hl-2">    }    </span><br/><span class="hl-2">  }</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-1">export</span><span class="hl-2"> </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">Track</span><span class="hl-2"> = </span><span class="hl-8">model</span><span class="hl-2">&lt;</span><span class="hl-4">TrackDocumentInterface</span><span class="hl-2">&gt;(</span><span class="hl-6">&#39;Track&#39;</span><span class="hl-2">, </span><span class="hl-5">TrackSchema</span><span class="hl-2">);</span>
</code></pre>
<p>En el código anterior podemos ver primero la declaración de la interfaz y su posterior esquema, con todos los campos solicitados en el guion de la práctica. En le esquema se ha añadido además una serie de validadores gracias al módulo <em>validator</em>, para asegurarnos que a la hora de crear el objeto se introducen valores válidos, como que el nombre de la ruta deba de empezar por mayúscula y que solamente pueda usar caractéres alphanuméricos y espacios, además de que la longitud de la ruta y la pendiente debe de ser un número positivo y finalmente la clafisicación de la ruta debe de estar entre 0 y 10.</p>

<a href="#challenge" id="challenge" style="color: inherit; text-decoration: none;">
  <h3>Challenge</h3>
</a>
<pre><code class="language-TypeScript"><span class="hl-0">/**</span><br/><span class="hl-0"> * Challenge interface for apply it in the challenge schema</span><br/><span class="hl-0"> */</span><br/><span class="hl-1">export</span><span class="hl-2"> </span><span class="hl-3">interface</span><span class="hl-2"> </span><span class="hl-4">ChallengeDocumentInterface</span><span class="hl-2"> </span><span class="hl-3">extends</span><span class="hl-2"> </span><span class="hl-4">Document</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-5">name</span><span class="hl-2">: </span><span class="hl-4">string</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-5">tracks</span><span class="hl-2">: </span><span class="hl-4">TrackDocumentInterface</span><span class="hl-2">[],</span><br/><span class="hl-2">  </span><span class="hl-5">activity</span><span class="hl-2">: </span><span class="hl-6">&#39;bike&#39;</span><span class="hl-2"> | </span><span class="hl-6">&#39;running&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-5">kms</span><span class="hl-2">: </span><span class="hl-4">number</span><span class="hl-2">,</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Challenge Schema for create challenge objects in the database</span><br/><span class="hl-0"> */</span><br/><span class="hl-1">export</span><span class="hl-2"> </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">ChallengeSchema</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Schema</span><span class="hl-2">&lt;</span><span class="hl-4">ChallengeDocumentInterface</span><span class="hl-2">&gt;({</span><br/><span class="hl-2">  </span><span class="hl-5">name:</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">String</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-5">unique:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-8">validate</span><span class="hl-5">:</span><span class="hl-2"> (</span><span class="hl-5">value</span><span class="hl-2">: </span><span class="hl-4">string</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">value</span><span class="hl-2">.</span><span class="hl-8">match</span><span class="hl-2">(</span><span class="hl-9">/</span><span class="hl-10">^</span><span class="hl-11">[</span><span class="hl-9">A-Z</span><span class="hl-11">]</span><span class="hl-9">/</span><span class="hl-2">)) {</span><br/><span class="hl-2">        </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Error</span><span class="hl-2">(</span><span class="hl-6">&#39;Challenge name must start with a capital letter&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">      } </span><span class="hl-1">else</span><span class="hl-2"> </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">validator</span><span class="hl-2">.</span><span class="hl-5">default</span><span class="hl-2">.</span><span class="hl-8">isAlphanumeric</span><span class="hl-2">(</span><span class="hl-5">value</span><span class="hl-2">.</span><span class="hl-8">replace</span><span class="hl-2">(</span><span class="hl-9">/\s/</span><span class="hl-3">g</span><span class="hl-2">, </span><span class="hl-6">&#39;&#39;</span><span class="hl-2">))) {</span><br/><span class="hl-2">        </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Error</span><span class="hl-2">(</span><span class="hl-6">&#39;Track name must contain alphanumeric characters and spaces only&#39;</span><span class="hl-2">)</span><br/><span class="hl-2">      }</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">  </span><span class="hl-5">tracks:</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-5">type:</span><span class="hl-2"> [</span><span class="hl-5">Schema</span><span class="hl-2">.</span><span class="hl-5">Types</span><span class="hl-2">.</span><span class="hl-5">ObjectId</span><span class="hl-2">],</span><br/><span class="hl-2">    </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-5">ref:</span><span class="hl-2"> </span><span class="hl-6">&#39;Track&#39;</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">  </span><span class="hl-5">activity:</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">String</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-5">enum:</span><span class="hl-2"> [</span><span class="hl-6">&#39;bike&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;running&#39;</span><span class="hl-2">],</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">  </span><span class="hl-5">kms:</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">Number</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">false</span><span class="hl-2">,</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-1">export</span><span class="hl-2"> </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">Challenge</span><span class="hl-2"> = </span><span class="hl-8">model</span><span class="hl-2">&lt;</span><span class="hl-4">ChallengeDocumentInterface</span><span class="hl-2">&gt;(</span><span class="hl-6">&#39;Challenge&#39;</span><span class="hl-2">, </span><span class="hl-5">ChallengeSchema</span><span class="hl-2">);</span>
</code></pre>
<p>En el caso de los retos, al igual que en rutas, declaramos la interfaz y su posterior esquema. Podemos ver que <em>tracks</em> y <em>users</em> son arrays de <em>ObjectId</em>, que hacen referencia a los documentos de <em>Track</em> y <em>User</em> respectivamente. Además, se ha añadido un validador para asegurarnos que el nombre del reto empieza por mayúscula y que solamente puede usar caractéres alphanuméricos y espacios.</p>

<a href="#user" id="user" style="color: inherit; text-decoration: none;">
  <h3>User</h3>
</a>
<pre><code class="language-TypeScript"><span class="hl-0">/**</span><br/><span class="hl-0"> * User interface for apply it in the User schema</span><br/><span class="hl-0"> */</span><br/><span class="hl-1">export</span><span class="hl-2"> </span><span class="hl-3">interface</span><span class="hl-2"> </span><span class="hl-4">UserDocumentInterface</span><span class="hl-2"> </span><span class="hl-3">extends</span><span class="hl-2"> </span><span class="hl-4">Document</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-5">_id</span><span class="hl-2">: </span><span class="hl-4">string</span><span class="hl-2">;</span><br/><span class="hl-2">  </span><span class="hl-5">name</span><span class="hl-2">: </span><span class="hl-4">string</span><span class="hl-2">;</span><br/><span class="hl-2">  </span><span class="hl-5">activity</span><span class="hl-2">: </span><span class="hl-6">&quot;bike&quot;</span><span class="hl-2"> | </span><span class="hl-6">&quot;running&quot;</span><span class="hl-2">;</span><br/><span class="hl-2">  </span><span class="hl-5">friends</span><span class="hl-2">: </span><span class="hl-4">UserDocumentInterface</span><span class="hl-2">[];</span><br/><span class="hl-2">  </span><span class="hl-5">friendsGroups</span><span class="hl-2">: {</span><br/><span class="hl-2">    </span><span class="hl-5">name</span><span class="hl-2">: </span><span class="hl-4">string</span><span class="hl-2">;</span><br/><span class="hl-2">    </span><span class="hl-5">friends</span><span class="hl-2">: </span><span class="hl-4">UserDocumentInterface</span><span class="hl-2">[];</span><br/><span class="hl-2">  }[];</span><br/><span class="hl-2">  </span><span class="hl-5">trainingStats</span><span class="hl-2">: {</span><br/><span class="hl-2">    </span><span class="hl-5">weekly</span><span class="hl-2">: {</span><br/><span class="hl-2">      </span><span class="hl-5">length</span><span class="hl-2">: </span><span class="hl-4">number</span><span class="hl-2">;</span><br/><span class="hl-2">      </span><span class="hl-5">unevenness</span><span class="hl-2">: </span><span class="hl-4">number</span><span class="hl-2">;</span><br/><span class="hl-2">    };</span><br/><span class="hl-2">    </span><span class="hl-5">monthly</span><span class="hl-2">: {</span><br/><span class="hl-2">      </span><span class="hl-5">length</span><span class="hl-2">: </span><span class="hl-4">number</span><span class="hl-2">;</span><br/><span class="hl-2">      </span><span class="hl-5">unevenness</span><span class="hl-2">: </span><span class="hl-4">number</span><span class="hl-2">;</span><br/><span class="hl-2">    };</span><br/><span class="hl-2">    </span><span class="hl-5">yearly</span><span class="hl-2">: {</span><br/><span class="hl-2">      </span><span class="hl-5">length</span><span class="hl-2">: </span><span class="hl-4">number</span><span class="hl-2">;</span><br/><span class="hl-2">      </span><span class="hl-5">unevenness</span><span class="hl-2">: </span><span class="hl-4">number</span><span class="hl-2">;</span><br/><span class="hl-2">    };</span><br/><span class="hl-2">  };</span><br/><span class="hl-2">  </span><span class="hl-5">favoriteTracks</span><span class="hl-2">: </span><span class="hl-4">TrackDocumentInterface</span><span class="hl-2">[];</span><br/><span class="hl-2">  </span><span class="hl-5">activeChallenges</span><span class="hl-2">: </span><span class="hl-4">ChallengeDocumentInterface</span><span class="hl-2">[];</span><br/><span class="hl-2">  </span><span class="hl-5">trackHistory</span><span class="hl-2">: {</span><br/><span class="hl-2">    </span><span class="hl-5">tracks</span><span class="hl-2">: </span><span class="hl-4">TrackDocumentInterface</span><span class="hl-2">[];</span><br/><span class="hl-2">    </span><span class="hl-5">date</span><span class="hl-2">: </span><span class="hl-4">string</span><span class="hl-2">;</span><br/><span class="hl-2">  }[];</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * User Schema for create User objects in the database</span><br/><span class="hl-0"> */</span><br/><span class="hl-1">export</span><span class="hl-2"> </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">UserSchema</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Schema</span><span class="hl-2">&lt;</span><span class="hl-4">UserDocumentInterface</span><span class="hl-2">&gt;({</span><br/><span class="hl-2">  </span><span class="hl-5">_id:</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">String</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">false</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-5">auto:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-8">default</span><span class="hl-5">:</span><span class="hl-2"> () </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-5">mongoose</span><span class="hl-2">.</span><span class="hl-5">Types</span><span class="hl-2">.</span><span class="hl-8">ObjectId</span><span class="hl-2">().</span><span class="hl-8">toString</span><span class="hl-2">()</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">  </span><span class="hl-5">name:</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">String</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-5">unique:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-8">validate</span><span class="hl-5">:</span><span class="hl-2"> (</span><span class="hl-5">value</span><span class="hl-2">: </span><span class="hl-4">string</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">value</span><span class="hl-2">.</span><span class="hl-8">match</span><span class="hl-2">(</span><span class="hl-9">/</span><span class="hl-10">^</span><span class="hl-11">[</span><span class="hl-9">A-Z</span><span class="hl-11">]</span><span class="hl-9">/</span><span class="hl-2">)) {</span><br/><span class="hl-2">        </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Error</span><span class="hl-2">(</span><span class="hl-6">&#39;User name must start with a capital letter&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">      } </span><span class="hl-1">else</span><span class="hl-2"> </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">validator</span><span class="hl-2">.</span><span class="hl-5">default</span><span class="hl-2">.</span><span class="hl-8">isAlphanumeric</span><span class="hl-2">(</span><span class="hl-5">value</span><span class="hl-2">)) {</span><br/><span class="hl-2">        </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Error</span><span class="hl-2">(</span><span class="hl-6">&#39;User name must contain alphanumeric characters only&#39;</span><span class="hl-2">)</span><br/><span class="hl-2">      }</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">  </span><span class="hl-5">activity:</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">String</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-5">enum:</span><span class="hl-2"> [</span><span class="hl-6">&quot;running&quot;</span><span class="hl-2">, </span><span class="hl-6">&quot;bike&quot;</span><span class="hl-2">],</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">  </span><span class="hl-5">friends:</span><span class="hl-2"> [</span><br/><span class="hl-2">    {</span><br/><span class="hl-2">      </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">Schema</span><span class="hl-2">.</span><span class="hl-5">Types</span><span class="hl-2">.</span><span class="hl-5">ObjectId</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">false</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-5">ref:</span><span class="hl-2"> </span><span class="hl-6">&quot;User&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-5">default:</span><span class="hl-2"> []</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">  ],</span><br/><span class="hl-2">  </span><span class="hl-5">friendsGroups:</span><span class="hl-2"> [</span><br/><span class="hl-2">    {</span><br/><span class="hl-2">      </span><span class="hl-5">name:</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">String</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">      </span><span class="hl-5">friends:</span><span class="hl-2"> [</span><br/><span class="hl-2">        {</span><br/><span class="hl-2">          </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">Schema</span><span class="hl-2">.</span><span class="hl-5">Types</span><span class="hl-2">.</span><span class="hl-5">ObjectId</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">false</span><span class="hl-2">,</span><br/><span class="hl-2">          </span><span class="hl-5">default:</span><span class="hl-2"> [],</span><br/><span class="hl-2">          </span><span class="hl-5">ref:</span><span class="hl-2"> </span><span class="hl-6">&quot;User&quot;</span><br/><span class="hl-2">        },</span><br/><span class="hl-2">      ],</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">  ],</span><br/><span class="hl-2">  </span><span class="hl-5">trainingStats:</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-5">weekly:</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-5">length:</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">Number</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-5">default:</span><span class="hl-2"> </span><span class="hl-12">0</span><span class="hl-2">,</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">      </span><span class="hl-5">unevenness:</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">Number</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-5">default:</span><span class="hl-2"> </span><span class="hl-12">0</span><span class="hl-2">,</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">    </span><span class="hl-5">monthly:</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-5">length:</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">Number</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-5">default:</span><span class="hl-2"> </span><span class="hl-12">0</span><span class="hl-2">,</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">      </span><span class="hl-5">unevenness:</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">Number</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-5">default:</span><span class="hl-2"> </span><span class="hl-12">0</span><span class="hl-2">,</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">    </span><span class="hl-5">yearly:</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-5">length:</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">Number</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-5">default:</span><span class="hl-2"> </span><span class="hl-12">0</span><span class="hl-2">,</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">      </span><span class="hl-5">unevenness:</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">Number</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-5">default:</span><span class="hl-2"> </span><span class="hl-12">0</span><span class="hl-2">,</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">  </span><span class="hl-5">favoriteTracks:</span><br/><span class="hl-2">    {</span><br/><span class="hl-2">      </span><span class="hl-5">type:</span><span class="hl-2"> [</span><span class="hl-5">Schema</span><span class="hl-2">.</span><span class="hl-5">Types</span><span class="hl-2">.</span><span class="hl-5">ObjectId</span><span class="hl-2">],</span><br/><span class="hl-2">      </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-5">ref:</span><span class="hl-2"> </span><span class="hl-6">&quot;Track&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-5">activeChallenges:</span><span class="hl-2"> [</span><br/><span class="hl-2">    {</span><br/><span class="hl-2">      </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">Schema</span><span class="hl-2">.</span><span class="hl-5">Types</span><span class="hl-2">.</span><span class="hl-5">ObjectId</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-5">ref:</span><span class="hl-2"> </span><span class="hl-6">&quot;Challenge&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">  ],</span><br/><span class="hl-2">  </span><span class="hl-5">trackHistory:</span><span class="hl-2"> [</span><br/><span class="hl-2">    {</span><br/><span class="hl-2">      </span><span class="hl-5">tracks:</span><span class="hl-2"> [{</span><br/><span class="hl-2">        </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">Schema</span><span class="hl-2">.</span><span class="hl-5">Types</span><span class="hl-2">.</span><span class="hl-5">ObjectId</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-5">ref:</span><span class="hl-2"> </span><span class="hl-6">&quot;Track&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      }],</span><br/><span class="hl-2">      </span><span class="hl-5">date:</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">String</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-8">validate</span><span class="hl-5">:</span><span class="hl-2"> (</span><span class="hl-5">value</span><span class="hl-2">: </span><span class="hl-4">string</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">          </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">value</span><span class="hl-2">.</span><span class="hl-8">match</span><span class="hl-2">(</span><span class="hl-9">/</span><span class="hl-10">^</span><span class="hl-11">([</span><span class="hl-9">0-9</span><span class="hl-11">]</span><span class="hl-13">{2}</span><span class="hl-11">)</span><span class="hl-9">-</span><span class="hl-11">([</span><span class="hl-9">0-9</span><span class="hl-11">]</span><span class="hl-13">{2}</span><span class="hl-11">)</span><span class="hl-9">-</span><span class="hl-11">([</span><span class="hl-9">0-9</span><span class="hl-11">]</span><span class="hl-13">{4}</span><span class="hl-11">)</span><span class="hl-10">$</span><span class="hl-9">/</span><span class="hl-2">)) {</span><br/><span class="hl-2">            </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Error</span><span class="hl-2">(</span><span class="hl-6">&#39;Date must have this format: DD-MM-YYYY&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">          }</span><br/><span class="hl-2">        }</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">  ],</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-1">export</span><span class="hl-2"> </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">User</span><span class="hl-2"> = </span><span class="hl-8">model</span><span class="hl-2">&lt;</span><span class="hl-4">UserDocumentInterface</span><span class="hl-2">&gt;(</span><span class="hl-6">&quot;User&quot;</span><span class="hl-2">, </span><span class="hl-5">UserSchema</span><span class="hl-2">);</span>
</code></pre>
<p>En el caso de los usuarios, al igual que en rutas y retos, declaramos la interfaz y su posterior esquema. Podemos ver que <em>friends</em> y <em>activeChallenges</em> son arrays de <em>ObjectId</em>, que hacen referencia a los documentos de <em>User</em> y <em>Challenge</em> respectivamente. Tenemos en el <em>id</em> que si no se le pasa un valor, se le asigna un <em>ObjectId</em> de mongoose. Además del validador del nombre, hemos añadido también en <em>trackHistory</em> un validador para asegurarnos que la fecha tiene el formato correcto.</p>

<a href="#group" id="group" style="color: inherit; text-decoration: none;">
  <h3>Group</h3>
</a>
<pre><code class="language-TypeScript"><span class="hl-0">/**</span><br/><span class="hl-0"> * Group interface for apply it in the Group schema</span><br/><span class="hl-0"> */</span><br/><span class="hl-1">export</span><span class="hl-2"> </span><span class="hl-3">interface</span><span class="hl-2"> </span><span class="hl-4">GroupDocumentInterface</span><span class="hl-2"> </span><span class="hl-3">extends</span><span class="hl-2"> </span><span class="hl-4">Document</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-5">name</span><span class="hl-2">: </span><span class="hl-4">string</span><span class="hl-2">;</span><br/><span class="hl-2">  </span><span class="hl-5">members</span><span class="hl-2">: </span><span class="hl-4">UserDocumentInterface</span><span class="hl-2">[];</span><br/><span class="hl-2">  </span><span class="hl-5">groupStats</span><span class="hl-2">: {</span><br/><span class="hl-2">    </span><span class="hl-5">weekly</span><span class="hl-2">: {</span><br/><span class="hl-2">      </span><span class="hl-5">length</span><span class="hl-2">: </span><span class="hl-4">number</span><span class="hl-2">;</span><br/><span class="hl-2">      </span><span class="hl-5">unevenness</span><span class="hl-2">: </span><span class="hl-4">number</span><span class="hl-2">;</span><br/><span class="hl-2">    };</span><br/><span class="hl-2">    </span><span class="hl-5">monthly</span><span class="hl-2">: {</span><br/><span class="hl-2">      </span><span class="hl-5">length</span><span class="hl-2">: </span><span class="hl-4">number</span><span class="hl-2">;</span><br/><span class="hl-2">      </span><span class="hl-5">unevenness</span><span class="hl-2">: </span><span class="hl-4">number</span><span class="hl-2">;</span><br/><span class="hl-2">    };</span><br/><span class="hl-2">    </span><span class="hl-5">yearly</span><span class="hl-2">: {</span><br/><span class="hl-2">      </span><span class="hl-5">length</span><span class="hl-2">: </span><span class="hl-4">number</span><span class="hl-2">;</span><br/><span class="hl-2">      </span><span class="hl-5">unevenness</span><span class="hl-2">: </span><span class="hl-4">number</span><span class="hl-2">;</span><br/><span class="hl-2">    };</span><br/><span class="hl-2">  };</span><br/><span class="hl-2">  </span><span class="hl-5">ranking</span><span class="hl-2">: {</span><br/><span class="hl-2">    </span><span class="hl-5">byLenght</span><span class="hl-2">: </span><span class="hl-4">UserDocumentInterface</span><span class="hl-2">[];</span><br/><span class="hl-2">    </span><span class="hl-5">byUnevenness</span><span class="hl-2">: </span><span class="hl-4">UserDocumentInterface</span><span class="hl-2">[];</span><br/><span class="hl-2">  };</span><br/><span class="hl-2">  </span><span class="hl-5">favoriteTracks</span><span class="hl-2">: </span><span class="hl-4">TrackDocumentInterface</span><span class="hl-2">[];</span><br/><span class="hl-2">  </span><span class="hl-5">trackHistory</span><span class="hl-2">: {</span><br/><span class="hl-2">    </span><span class="hl-5">tracks</span><span class="hl-2">: </span><span class="hl-4">TrackDocumentInterface</span><span class="hl-2">[];</span><br/><span class="hl-2">    </span><span class="hl-5">date</span><span class="hl-2">: </span><span class="hl-4">string</span><span class="hl-2">;</span><br/><span class="hl-2">  }[];</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Group Schema for create Group objects in the database</span><br/><span class="hl-0"> */</span><br/><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">GroupSchema</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Schema</span><span class="hl-2">&lt;</span><span class="hl-4">GroupDocumentInterface</span><span class="hl-2">&gt;({</span><br/><span class="hl-2">  </span><span class="hl-5">name:</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">String</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-5">unique:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-8">validate</span><span class="hl-5">:</span><span class="hl-2"> (</span><span class="hl-5">value</span><span class="hl-2">: </span><span class="hl-4">string</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">value</span><span class="hl-2">.</span><span class="hl-8">match</span><span class="hl-2">(</span><span class="hl-9">/</span><span class="hl-10">^</span><span class="hl-11">[</span><span class="hl-9">A-Z</span><span class="hl-11">]</span><span class="hl-9">/</span><span class="hl-2">)) {</span><br/><span class="hl-2">        </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Error</span><span class="hl-2">(</span><span class="hl-6">&#39;Group name must start with a capital letter&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">      } </span><span class="hl-1">else</span><span class="hl-2"> </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">validator</span><span class="hl-2">.</span><span class="hl-5">default</span><span class="hl-2">.</span><span class="hl-8">isAlphanumeric</span><span class="hl-2">(</span><span class="hl-5">value</span><span class="hl-2">.</span><span class="hl-8">replace</span><span class="hl-2">(</span><span class="hl-9">/\s/</span><span class="hl-3">g</span><span class="hl-2">, </span><span class="hl-6">&#39;&#39;</span><span class="hl-2">))) {</span><br/><span class="hl-2">        </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Error</span><span class="hl-2">(</span><span class="hl-6">&#39;Track name must contain alphanumeric characters and spaces only&#39;</span><span class="hl-2">)</span><br/><span class="hl-2">      }</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">  </span><span class="hl-5">members:</span><span class="hl-2"> [</span><br/><span class="hl-2">    {</span><br/><span class="hl-2">      </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">Schema</span><span class="hl-2">.</span><span class="hl-5">Types</span><span class="hl-2">.</span><span class="hl-5">ObjectId</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-5">ref:</span><span class="hl-2"> </span><span class="hl-6">&quot;User&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">  ],</span><br/><span class="hl-2">  </span><span class="hl-5">groupStats:</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-5">weekly:</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-5">length:</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">Number</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-5">default:</span><span class="hl-2"> </span><span class="hl-12">0</span><span class="hl-2">,</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">      </span><span class="hl-5">unevenness:</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">Number</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-5">default:</span><span class="hl-2"> </span><span class="hl-12">0</span><span class="hl-2">,</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">    </span><span class="hl-5">monthly:</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-5">length:</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">Number</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-5">default:</span><span class="hl-2"> </span><span class="hl-12">0</span><span class="hl-2">,</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">      </span><span class="hl-5">unevenness:</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">Number</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-5">default:</span><span class="hl-2"> </span><span class="hl-12">0</span><span class="hl-2">,</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">    </span><span class="hl-5">yearly:</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-5">length:</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">Number</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-5">default:</span><span class="hl-2"> </span><span class="hl-12">0</span><span class="hl-2">,</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">      </span><span class="hl-5">unevenness:</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">Number</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-5">default:</span><span class="hl-2"> </span><span class="hl-12">0</span><span class="hl-2">,</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">  </span><span class="hl-5">ranking:</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-5">byLenght:</span><span class="hl-2"> [</span><br/><span class="hl-2">      {</span><br/><span class="hl-2">        </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">Schema</span><span class="hl-2">.</span><span class="hl-5">Types</span><span class="hl-2">.</span><span class="hl-5">ObjectId</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">false</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-5">ref:</span><span class="hl-2"> </span><span class="hl-6">&quot;User&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">    ],</span><br/><span class="hl-2">    </span><span class="hl-5">byUnevenness:</span><span class="hl-2"> [</span><br/><span class="hl-2">      {</span><br/><span class="hl-2">        </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">Schema</span><span class="hl-2">.</span><span class="hl-5">Types</span><span class="hl-2">.</span><span class="hl-5">ObjectId</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">false</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-5">ref:</span><span class="hl-2"> </span><span class="hl-6">&quot;User&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">    ],</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">  </span><span class="hl-5">favoriteTracks:</span><span class="hl-2"> [</span><br/><span class="hl-2">     {</span><br/><span class="hl-2">        </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">Schema</span><span class="hl-2">.</span><span class="hl-5">Types</span><span class="hl-2">.</span><span class="hl-5">ObjectId</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-5">ref:</span><span class="hl-2"> </span><span class="hl-6">&quot;Track&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">    ],</span><br/><span class="hl-2">  </span><span class="hl-5">trackHistory:</span><span class="hl-2"> [</span><br/><span class="hl-2">    {</span><br/><span class="hl-2">      </span><span class="hl-5">tracks:</span><span class="hl-2"> [{</span><br/><span class="hl-2">        </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">Schema</span><span class="hl-2">.</span><span class="hl-5">Types</span><span class="hl-2">.</span><span class="hl-5">ObjectId</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">false</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-5">ref:</span><span class="hl-2"> </span><span class="hl-6">&quot;Track&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">      }],</span><br/><span class="hl-2">      </span><span class="hl-5">date:</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-5">String</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-5">required:</span><span class="hl-2"> </span><span class="hl-3">false</span><span class="hl-2">,</span><br/><span class="hl-2">        </span><span class="hl-8">validate</span><span class="hl-5">:</span><span class="hl-2"> (</span><span class="hl-5">value</span><span class="hl-2">: </span><span class="hl-4">string</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">          </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">value</span><span class="hl-2">.</span><span class="hl-8">match</span><span class="hl-2">(</span><span class="hl-9">/</span><span class="hl-10">^</span><span class="hl-11">([</span><span class="hl-9">0-9</span><span class="hl-11">]</span><span class="hl-13">{2}</span><span class="hl-11">)</span><span class="hl-9">-</span><span class="hl-11">([</span><span class="hl-9">0-9</span><span class="hl-11">]</span><span class="hl-13">{2}</span><span class="hl-11">)</span><span class="hl-9">-</span><span class="hl-11">([</span><span class="hl-9">0-9</span><span class="hl-11">]</span><span class="hl-13">{4}</span><span class="hl-11">)</span><span class="hl-10">$</span><span class="hl-9">/</span><span class="hl-2">)) {</span><br/><span class="hl-2">            </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Error</span><span class="hl-2">(</span><span class="hl-6">&#39;Date must have this format: DD-MM-YYYY&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">          }</span><br/><span class="hl-2">        }</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">  ],</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-1">export</span><span class="hl-2"> </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">Group</span><span class="hl-2"> = </span><span class="hl-8">model</span><span class="hl-2">&lt;</span><span class="hl-4">GroupDocumentInterface</span><span class="hl-2">&gt;(</span><span class="hl-6">&quot;Group&quot;</span><span class="hl-2">, </span><span class="hl-5">GroupSchema</span><span class="hl-2">);</span>
</code></pre>
<p>En el caso de los grupos tenemos la misma estructura que en el resto. En este caso, <em>members</em> es un array de <em>ObjectId</em> que hace referencia a los documentos de <em>User</em>. En <em>ranking</em> tenemos dos arrays de <em>ObjectId</em> que hacen referencia a los documentos de <em>User</em>. En <em>trackHistory</em> tenemos un array de objetos que contiene un array de <em>ObjectId</em> que hace referencia a los documentos de <em>Track</em> y una fecha con su validador correspondiente.</p>

<a href="#rutas-de-la-api" id="rutas-de-la-api" style="color: inherit; text-decoration: none;">
  <h2>Rutas de la API</h2>
</a>
<p>El código se encuentra estructurado de la siguiente forma: dentro del directorio <em>routers</em> se encuentra un fichero por cada una de las rutas anteriormente comentadas, las cuales se unen y son usadas por el servidor express, en el fichero <em>destravate</em>:</p>
<pre><code class="language-TypeScript"><span class="hl-1">export</span><span class="hl-2"> </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">app</span><span class="hl-2"> = </span><span class="hl-8">express</span><span class="hl-2">();</span><br/><span class="hl-5">app</span><span class="hl-2">.</span><span class="hl-8">use</span><span class="hl-2">(</span><span class="hl-5">express</span><span class="hl-2">.</span><span class="hl-8">json</span><span class="hl-2">());</span><br/><br/><span class="hl-5">app</span><span class="hl-2">.</span><span class="hl-8">use</span><span class="hl-2">(</span><span class="hl-6">&#39;/tracks&#39;</span><span class="hl-2">, </span><span class="hl-5">trackRouter</span><span class="hl-2">);</span><br/><span class="hl-5">app</span><span class="hl-2">.</span><span class="hl-8">use</span><span class="hl-2">(</span><span class="hl-6">&#39;/users&#39;</span><span class="hl-2">, </span><span class="hl-5">userRouter</span><span class="hl-2">);</span><br/><span class="hl-5">app</span><span class="hl-2">.</span><span class="hl-8">use</span><span class="hl-2">(</span><span class="hl-6">&#39;/groups&#39;</span><span class="hl-2">, </span><span class="hl-5">groupRouter</span><span class="hl-2">);</span><br/><span class="hl-5">app</span><span class="hl-2">.</span><span class="hl-8">use</span><span class="hl-2">(</span><span class="hl-6">&#39;/challenges&#39;</span><span class="hl-2">, </span><span class="hl-5">challengeRouter</span><span class="hl-2">);</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Show 404 error if access to a wrong path.</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">app</span><span class="hl-2">.</span><span class="hl-8">all</span><span class="hl-2">(</span><span class="hl-6">&#39;*&#39;</span><span class="hl-2">, (</span><span class="hl-5">_</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">404</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">();</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-5">app</span><span class="hl-2">.</span><span class="hl-8">listen</span><span class="hl-2">(</span><span class="hl-12">3000</span><span class="hl-2">, () </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-5">console</span><span class="hl-2">.</span><span class="hl-8">log</span><span class="hl-2">(</span><span class="hl-6">&#39;Servidor escuchando en el puerto 3000.&#39;</span><span class="hl-2">)</span><br/><span class="hl-2">})</span>
</code></pre>
<p>En cada una de las rutas cuyo código se mostrará y explicará a continuación se han incluido todas las operaciones solicitadas en el enunciado de la práctica (POST, GET, PATCH, DELETE) usando tanto una <em>query string</em> como el <em>id</em>.</p>

<a href="#tracks" id="tracks" style="color: inherit; text-decoration: none;">
  <h3>Tracks</h3>
</a>
<pre><code class="language-TypeScript"><span class="hl-0">/**</span><br/><span class="hl-0"> * When a track is deleted, this is deleted in other objects that incluid it.</span><br/><span class="hl-0"> * </span><span class="hl-3">@param</span><span class="hl-0"> </span><span class="hl-5">track</span><span class="hl-0"> The track that is deleted.</span><br/><span class="hl-0"> */</span><br/><span class="hl-1">export</span><span class="hl-2"> </span><span class="hl-3">async</span><span class="hl-2"> </span><span class="hl-3">function</span><span class="hl-2"> </span><span class="hl-8">deleteInOtherObjects</span><span class="hl-2">(</span><span class="hl-5">track</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-0">// Cuando se elimina una ruta, también lo hace del reto.</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">trackChallenge</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">Challenge</span><span class="hl-2">.</span><span class="hl-8">find</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-5">tracks:</span><span class="hl-2"> </span><span class="hl-5">track</span><span class="hl-2">.</span><span class="hl-5">_id</span><br/><span class="hl-2">  });</span><br/><span class="hl-2">      </span><br/><span class="hl-2">  </span><span class="hl-5">trackChallenge</span><span class="hl-2">.</span><span class="hl-8">forEach</span><span class="hl-2">(</span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">item</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">index</span><span class="hl-2"> = </span><span class="hl-5">item</span><span class="hl-2">.</span><span class="hl-5">tracks</span><span class="hl-2">.</span><span class="hl-8">indexOf</span><span class="hl-2">(</span><span class="hl-5">track</span><span class="hl-2">.</span><span class="hl-5">_id</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-5">index</span><span class="hl-2"> &gt; -</span><span class="hl-12">1</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-5">item</span><span class="hl-2">.</span><span class="hl-5">tracks</span><span class="hl-2">.</span><span class="hl-8">splice</span><span class="hl-2">(</span><span class="hl-5">index</span><span class="hl-2">, </span><span class="hl-12">1</span><span class="hl-2">);</span><br/><span class="hl-2">      </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">item</span><span class="hl-2">.</span><span class="hl-8">save</span><span class="hl-2">();</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">    </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-8">updateKms</span><span class="hl-2">(</span><span class="hl-5">item</span><span class="hl-2">);</span><br/><span class="hl-2">  });</span><br/><br/><span class="hl-2">  </span><span class="hl-0">// Cuando se elimina una ruta, también lo hace de las rutas favoritas del usuario.</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">trackUser</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">User</span><span class="hl-2">.</span><span class="hl-8">find</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-5">favoriteTracks:</span><span class="hl-2"> </span><span class="hl-5">track</span><span class="hl-2">.</span><span class="hl-5">_id</span><br/><span class="hl-2">  });</span><br/><span class="hl-2">      </span><br/><span class="hl-2">  </span><span class="hl-5">trackUser</span><span class="hl-2">.</span><span class="hl-8">forEach</span><span class="hl-2">(</span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">item</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">index</span><span class="hl-2"> = </span><span class="hl-5">item</span><span class="hl-2">.</span><span class="hl-5">favoriteTracks</span><span class="hl-2">.</span><span class="hl-8">indexOf</span><span class="hl-2">(</span><span class="hl-5">track</span><span class="hl-2">.</span><span class="hl-5">_id</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-5">index</span><span class="hl-2"> &gt; -</span><span class="hl-12">1</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-5">item</span><span class="hl-2">.</span><span class="hl-5">favoriteTracks</span><span class="hl-2">.</span><span class="hl-8">splice</span><span class="hl-2">(</span><span class="hl-5">index</span><span class="hl-2">, </span><span class="hl-12">1</span><span class="hl-2">);</span><br/><span class="hl-2">      </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">item</span><span class="hl-2">.</span><span class="hl-8">save</span><span class="hl-2">();</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  });</span><br/><br/><span class="hl-2">  </span><span class="hl-0">// Cuando se elimina una ruta, también lo hace de las rutas favoritas del grupo.</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">trackGroup</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">Group</span><span class="hl-2">.</span><span class="hl-8">find</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-5">favoriteTracks:</span><span class="hl-2"> </span><span class="hl-5">track</span><span class="hl-2">.</span><span class="hl-5">_id</span><br/><span class="hl-2">  });</span><br/><span class="hl-2">      </span><br/><span class="hl-2">  </span><span class="hl-5">trackGroup</span><span class="hl-2">.</span><span class="hl-8">forEach</span><span class="hl-2">(</span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">item</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">index</span><span class="hl-2"> = </span><span class="hl-5">item</span><span class="hl-2">.</span><span class="hl-5">favoriteTracks</span><span class="hl-2">.</span><span class="hl-8">indexOf</span><span class="hl-2">(</span><span class="hl-5">track</span><span class="hl-2">.</span><span class="hl-5">_id</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-5">index</span><span class="hl-2"> &gt; -</span><span class="hl-12">1</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-5">item</span><span class="hl-2">.</span><span class="hl-5">favoriteTracks</span><span class="hl-2">.</span><span class="hl-8">splice</span><span class="hl-2">(</span><span class="hl-5">index</span><span class="hl-2">, </span><span class="hl-12">1</span><span class="hl-2">);</span><br/><span class="hl-2">      </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">item</span><span class="hl-2">.</span><span class="hl-8">save</span><span class="hl-2">();</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  });</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Get all the tracks in the database or only one if the query string name exists</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">trackRouter</span><span class="hl-2">.</span><span class="hl-8">get</span><span class="hl-2">(</span><span class="hl-6">&#39;/&#39;</span><span class="hl-2">,  </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">filter</span><span class="hl-2"> = </span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">query</span><span class="hl-2">.</span><span class="hl-5">name</span><span class="hl-2">?{</span><span class="hl-5">name:</span><span class="hl-2"> </span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">query</span><span class="hl-2">.</span><span class="hl-5">name</span><span class="hl-2">.</span><span class="hl-8">toString</span><span class="hl-2">()}:{};</span><br/><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">tracks</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">Track</span><span class="hl-2">.</span><span class="hl-8">find</span><span class="hl-2">(</span><span class="hl-5">filter</span><span class="hl-2">);</span><br/><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-5">tracks</span><span class="hl-2">.</span><span class="hl-5">length</span><span class="hl-2"> !== </span><span class="hl-12">0</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">tracks</span><span class="hl-2">);</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">404</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">();</span><br/><span class="hl-2">  } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">error</span><span class="hl-2">);</span><br/><span class="hl-2">  }  </span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Get a specify track according to its ID</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">trackRouter</span><span class="hl-2">.</span><span class="hl-8">get</span><span class="hl-2">(</span><span class="hl-6">&#39;/:id&#39;</span><span class="hl-2">, </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">track</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">Track</span><span class="hl-2">.</span><span class="hl-8">findById</span><span class="hl-2">(</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">params</span><span class="hl-2">.</span><span class="hl-5">id</span><span class="hl-2">); </span><br/><span class="hl-2">  </span><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-5">track</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">track</span><span class="hl-2">);</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">404</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">();</span><br/><span class="hl-2">  } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">error</span><span class="hl-2">);</span><br/><span class="hl-2">  } </span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Create a track in the database</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">trackRouter</span><span class="hl-2">.</span><span class="hl-8">post</span><span class="hl-2">(</span><span class="hl-6">&#39;/&#39;</span><span class="hl-2">, </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">track</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Track</span><span class="hl-2">(</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">body</span><span class="hl-2">);</span><br/><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">track</span><span class="hl-2">.</span><span class="hl-8">save</span><span class="hl-2">();</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">201</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">track</span><span class="hl-2">);</span><br/><span class="hl-2">  } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">error</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Modify a track in the database using its name as query string</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">trackRouter</span><span class="hl-2">.</span><span class="hl-8">patch</span><span class="hl-2">(</span><span class="hl-6">&#39;/&#39;</span><span class="hl-2">, </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">query</span><span class="hl-2">.</span><span class="hl-5">name</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">400</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-5">error:</span><span class="hl-2"> </span><span class="hl-6">&#39;A track name must be provided&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">    });</span><br/><span class="hl-2">  } </span><br/><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">allowedUpdates</span><span class="hl-2"> = [</span><span class="hl-6">&#39;name&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;startGeolocation&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;endGeolocation&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;length&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;unevenness&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;activity&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;rating&#39;</span><span class="hl-2">];</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">actualUpdates</span><span class="hl-2"> = </span><span class="hl-5">Object</span><span class="hl-2">.</span><span class="hl-8">keys</span><span class="hl-2">(</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">body</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">isValidUpdate</span><span class="hl-2"> = </span><span class="hl-5">actualUpdates</span><span class="hl-2">.</span><span class="hl-8">every</span><span class="hl-2">((</span><span class="hl-5">update</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-5">allowedUpdates</span><span class="hl-2">.</span><span class="hl-8">includes</span><span class="hl-2">(</span><span class="hl-5">update</span><span class="hl-2">));</span><br/><br/><span class="hl-2">  </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">isValidUpdate</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">400</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-5">error:</span><span class="hl-2"> </span><span class="hl-6">&#39;Update is not permitted&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">    });</span><br/><span class="hl-2">  }</span><br/><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">track</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">Track</span><span class="hl-2">.</span><span class="hl-8">findOneAndUpdate</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-5">name:</span><span class="hl-2"> </span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">query</span><span class="hl-2">.</span><span class="hl-5">name</span><span class="hl-2">.</span><span class="hl-8">toString</span><span class="hl-2">()</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">    </span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">body</span><span class="hl-2">,</span><br/><span class="hl-2">    {</span><br/><span class="hl-2">      </span><span class="hl-5">new:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-5">runValidators:</span><span class="hl-2"> </span><span class="hl-3">true</span><br/><span class="hl-2">    });</span><br/><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-5">track</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">track</span><span class="hl-2">);</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">404</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">();</span><br/><span class="hl-2">  } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">error</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Modify a track in the database using its ID</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">trackRouter</span><span class="hl-2">.</span><span class="hl-8">patch</span><span class="hl-2">(</span><span class="hl-6">&#39;/:id&#39;</span><span class="hl-2">, </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {  </span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">allowedUpdates</span><span class="hl-2"> = [</span><span class="hl-6">&#39;name&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;startGeolocation&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;endGeolocation&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;length&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;unevenness&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;activity&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;rating&#39;</span><span class="hl-2">];</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">actualUpdates</span><span class="hl-2"> = </span><span class="hl-5">Object</span><span class="hl-2">.</span><span class="hl-8">keys</span><span class="hl-2">(</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">body</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">isValidUpdate</span><span class="hl-2"> = </span><span class="hl-5">actualUpdates</span><span class="hl-2">.</span><span class="hl-8">every</span><span class="hl-2">((</span><span class="hl-5">update</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-5">allowedUpdates</span><span class="hl-2">.</span><span class="hl-8">includes</span><span class="hl-2">(</span><span class="hl-5">update</span><span class="hl-2">));</span><br/><br/><span class="hl-2">  </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">isValidUpdate</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">400</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-5">error:</span><span class="hl-2"> </span><span class="hl-6">&#39;Update is not permitted&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">    });</span><br/><span class="hl-2">  }</span><br/><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">track</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">Track</span><span class="hl-2">.</span><span class="hl-8">findByIdAndUpdate</span><span class="hl-2">(</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">params</span><span class="hl-2">.</span><span class="hl-5">id</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">body</span><span class="hl-2">,</span><br/><span class="hl-2">    {</span><br/><span class="hl-2">      </span><span class="hl-5">new:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-5">runValidators:</span><span class="hl-2"> </span><span class="hl-3">true</span><br/><span class="hl-2">    });</span><br/><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-5">track</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">track</span><span class="hl-2">);</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">404</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">();</span><br/><span class="hl-2">  } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">error</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Delete a track in the database using its name as query string</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">trackRouter</span><span class="hl-2">.</span><span class="hl-8">delete</span><span class="hl-2">(</span><span class="hl-6">&#39;/&#39;</span><span class="hl-2">, </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">query</span><span class="hl-2">.</span><span class="hl-5">name</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">400</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-5">error:</span><span class="hl-2"> </span><span class="hl-6">&#39;A track name must be provided&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">    });</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">track</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">Track</span><span class="hl-2">.</span><span class="hl-8">findOneAndDelete</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-5">name:</span><span class="hl-2"> </span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">query</span><span class="hl-2">.</span><span class="hl-5">name</span><span class="hl-2">.</span><span class="hl-8">toString</span><span class="hl-2">(),</span><br/><span class="hl-2">    });</span><br/><span class="hl-2">    </span><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">track</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">404</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">();</span><br/><span class="hl-2">    } </span><span class="hl-1">else</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">track</span><span class="hl-2">);</span><br/><span class="hl-2">    }</span><br/><br/><span class="hl-2">    </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-8">deleteInOtherObjects</span><span class="hl-2">(</span><span class="hl-5">track</span><span class="hl-2">);</span><br/><br/><span class="hl-2">    } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">error</span><span class="hl-2">);</span><br/><span class="hl-2">    }  </span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Delete a track in the database using its ID</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">trackRouter</span><span class="hl-2">.</span><span class="hl-8">delete</span><span class="hl-2">(</span><span class="hl-6">&#39;/:id&#39;</span><span class="hl-2">, </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">track</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">Track</span><span class="hl-2">.</span><span class="hl-8">findByIdAndDelete</span><span class="hl-2">(</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">params</span><span class="hl-2">.</span><span class="hl-5">id</span><span class="hl-2">);</span><br/><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">track</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">404</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">();</span><br/><span class="hl-2">    } </span><span class="hl-1">else</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">track</span><span class="hl-2">);</span><br/><span class="hl-2">    }</span><br/><span class="hl-2"> </span><br/><span class="hl-2">    </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-8">deleteInOtherObjects</span><span class="hl-2">(</span><span class="hl-5">track</span><span class="hl-2">);</span><br/><br/><span class="hl-2">  } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">error</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">});</span>
</code></pre>
<p>Lo primero que observamos es una función <em>deleteInOtherObjects</em> la cual es llamada cada vez que se elimina una ruta para así actualizar el resto de objetos que incluyen dicha ruta, siendo estos los retos, los usuarios y los grupos. A continuación se implementan las operaciones a través de los métodos HTTP, comenzando con el GET, donde mediante el filtro y una <em>query</em> <em>string</em> podemos seleccionar mostrar una ruta en concreto o todas las que se encuentran en la base de datos, también se ha incluido el get, donde la busqueda de la ruta se lleva a cabo por su identificador único dentro de la base de datos.
<br><br>En cuanto al POST, se recupero lo que ha introducido el usuario a través del body y si pasa todos los requisitos introducidos en el modelo, se añadirá la ruta a la base de datos. El PATCH sigue el mismo espíritu, primero tiene que encontrar la ruta que se desea modificar de distinta manera dependiendo si es con ID o mediante una <em>query string</em>, posteriormente se comprueba si los campos introducidos en el <em>body</em> son aptos para la modificación, y si es así, se actualiza.
<br><br>Finalmente tenemos el método DELETE, donde una vez más se lleva a cabo de las dos formas solicitadas y en ambas se llama a la función <em>deleteInOtherObjects</em> para eliminar dicha ruta del resto de elementos, tal y como comentábamos anteriormente.
<br><br>Para todas las rutas se han realizado una gran cantidad de pruebas con el fin de probar la mayor cantidad de combinaciones posibles y que las operaciones se llevan a cabo sin problema. La principal adición a las pruebas respecto de las prácticas anteriores es el uso de <em>supertest</em>. Las pruebas llevadas a cabo para <em>Tracks</em> son las siguientes:</p>
<pre><code><span class="hl-2">  </span><span class="hl-7">POST</span><span class="hl-2"> /</span><span class="hl-5">tracks</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-5">create</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-5">track</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">when</span><span class="hl-2"> </span><span class="hl-5">creating</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">track</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">name</span><span class="hl-2"> </span><span class="hl-5">is</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">according</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-8">validator</span><span class="hl-2"> (</span><span class="hl-5">Uso</span><span class="hl-2"> </span><span class="hl-5">characters</span><span class="hl-2"> </span><span class="hl-5">that</span><span class="hl-2"> </span><span class="hl-5">are</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">alphanumeric</span><span class="hl-2">)</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">when</span><span class="hl-2"> </span><span class="hl-5">creating</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">track</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">length</span><span class="hl-2"> </span><span class="hl-5">and</span><span class="hl-2"> </span><span class="hl-5">unevenness</span><span class="hl-2"> </span><span class="hl-5">are</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">according</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-8">validator</span><span class="hl-2"> (</span><span class="hl-5">they</span><span class="hl-2"> </span><span class="hl-5">are</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> &gt; </span><span class="hl-12">0</span><span class="hl-2">)</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">when</span><span class="hl-2"> </span><span class="hl-5">creating</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">track</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">activity</span><span class="hl-2"> </span><span class="hl-5">is</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">according</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-8">validator</span><span class="hl-2"> (</span><span class="hl-5">only</span><span class="hl-2"> </span><span class="hl-5">can</span><span class="hl-2"> </span><span class="hl-5">be</span><span class="hl-2"> </span><span class="hl-5">running</span><span class="hl-2"> </span><span class="hl-5">or</span><span class="hl-2"> </span><span class="hl-5">bike</span><span class="hl-2">)</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">when</span><span class="hl-2"> </span><span class="hl-5">creating</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">track</span><br/><br/><span class="hl-2">  </span><span class="hl-7">GET</span><span class="hl-2"> /</span><span class="hl-5">tracks</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-5">consult</span><span class="hl-2"> </span><span class="hl-5">all</span><span class="hl-2"> </span><span class="hl-5">tracks</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-5">consult</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">specific</span><span class="hl-2"> </span><span class="hl-5">track</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-5">consult</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">specific</span><span class="hl-2"> </span><span class="hl-5">track</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">find</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">find</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">consult</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">invalid</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><br/><span class="hl-2">  </span><span class="hl-7">PATCH</span><span class="hl-2"> /</span><span class="hl-5">tracks</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-5">modify</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">track</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-5">modify</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">track</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">find</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">track</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">modify</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">find</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">track</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">modify</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">400</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">provide</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">track</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">400</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">update</span><span class="hl-2"> </span><span class="hl-5">is</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">permited</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">400</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">update</span><span class="hl-2"> </span><span class="hl-5">is</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">permited</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-1">do</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">invalid</span><span class="hl-2"> </span><span class="hl-5">modification</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-8">name</span><span class="hl-2"> (</span><span class="hl-5">length</span><span class="hl-2"> </span><span class="hl-5">can</span><span class="hl-6">&#39;t be &lt;= 0</span><span class="hl-14">)</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">do</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">invalid</span><span class="hl-2"> </span><span class="hl-5">modification</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-8">name</span><span class="hl-2"> (</span><span class="hl-5">The</span><span class="hl-2"> </span><span class="hl-5">track</span><span class="hl-2"> </span><span class="hl-5">name</span><span class="hl-2"> </span><span class="hl-5">must</span><span class="hl-2"> </span><span class="hl-5">start</span><span class="hl-2"> </span><span class="hl-5">with</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">capital</span><span class="hl-2"> </span><span class="hl-5">letter</span><span class="hl-2">)</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">do</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">invalid</span><span class="hl-2"> </span><span class="hl-5">modification</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-8">ID</span><span class="hl-2"> (</span><span class="hl-5">length</span><span class="hl-2"> </span><span class="hl-5">can</span><span class="hl-6">&#39;t be &lt;= 0</span><span class="hl-14">)</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">do</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">invalid</span><span class="hl-2"> </span><span class="hl-5">modification</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-8">ID</span><span class="hl-2"> (</span><span class="hl-5">The</span><span class="hl-2"> </span><span class="hl-5">track</span><span class="hl-2"> </span><span class="hl-5">name</span><span class="hl-2"> </span><span class="hl-5">must</span><span class="hl-2"> </span><span class="hl-5">start</span><span class="hl-2"> </span><span class="hl-5">with</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">capital</span><span class="hl-2"> </span><span class="hl-5">letter</span><span class="hl-2">)</span><br/><br/><span class="hl-2">  </span><span class="hl-7">DELETE</span><span class="hl-2"> /</span><span class="hl-5">tracks</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-3">delete</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">track</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-3">delete</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">track</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">find</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">track</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-3">delete</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">find</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">track</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-3">delete</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">try</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-3">delete</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">track</span><span class="hl-2"> </span><span class="hl-5">with</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">invalid</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-3">delete</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">track</span><span class="hl-2"> </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">tracks</span><span class="hl-2"> </span><span class="hl-5">that</span><span class="hl-2"> </span><span class="hl-5">make</span><span class="hl-2"> </span><span class="hl-5">up</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">challenge</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-3">delete</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">track</span><span class="hl-2"> </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-6">&#39;s favoriteTrack</span><span class="hl-14">s</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-3">delete</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">track</span><span class="hl-2"> </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">group</span><span class="hl-6">&#39;s favoriteTrack</span><span class="hl-14">s</span>
</code></pre>

<a href="#challenges" id="challenges" style="color: inherit; text-decoration: none;">
  <h3>Challenges</h3>
</a>
<pre><code class="language-Typescript"><span class="hl-0">/**</span><br/><span class="hl-0"> * Update Kms when the challenger&#39;s tracks are modified</span><br/><span class="hl-0"> * </span><span class="hl-3">@param</span><span class="hl-0"> </span><span class="hl-5">challenge</span><span class="hl-0"> Challenge whose kms are going to be update</span><br/><span class="hl-0"> * </span><span class="hl-3">@param</span><span class="hl-0"> </span><span class="hl-5">res</span><span class="hl-0"> Response to the express server</span><br/><span class="hl-0"> * </span><span class="hl-3">@returns</span><span class="hl-0"> void</span><br/><span class="hl-0"> */</span><br/><span class="hl-1">export</span><span class="hl-2"> </span><span class="hl-3">async</span><span class="hl-2"> </span><span class="hl-3">function</span><span class="hl-2"> </span><span class="hl-8">updateKms</span><span class="hl-2">(</span><span class="hl-5">challenge</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-5">kms</span><span class="hl-2"> = </span><span class="hl-12">0</span><span class="hl-2">;</span><br/><br/><span class="hl-2">  </span><span class="hl-1">for</span><span class="hl-2"> (</span><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-5">i</span><span class="hl-2"> = </span><span class="hl-12">0</span><span class="hl-2">; </span><span class="hl-5">i</span><span class="hl-2"> &lt; </span><span class="hl-5">challenge</span><span class="hl-2">.</span><span class="hl-5">tracks</span><span class="hl-2">.</span><span class="hl-5">length</span><span class="hl-2">; </span><span class="hl-5">i</span><span class="hl-2">++) {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">track</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">Track</span><span class="hl-2">.</span><span class="hl-8">findById</span><span class="hl-2">(</span><span class="hl-5">challenge</span><span class="hl-2">.</span><span class="hl-5">tracks</span><span class="hl-2">[</span><span class="hl-5">i</span><span class="hl-2">]);</span><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">track</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Error</span><span class="hl-2">(</span><span class="hl-6">&quot;Any track is not found&quot;</span><span class="hl-2">)</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">    </span><span class="hl-5">kms</span><span class="hl-2"> += </span><span class="hl-5">track</span><span class="hl-2">.</span><span class="hl-5">length</span><span class="hl-2">;</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><span class="hl-5">challenge</span><span class="hl-2">.</span><span class="hl-5">kms</span><span class="hl-2"> = </span><span class="hl-5">kms</span><span class="hl-2">;</span><br/><span class="hl-2">  </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">challenge</span><span class="hl-2">.</span><span class="hl-8">save</span><span class="hl-2">();</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Check if an item exists in the database when its ID is going to use for create/modify a challenge, in this case the tracks.</span><br/><span class="hl-0"> * </span><span class="hl-3">@param</span><span class="hl-0"> </span><span class="hl-5">challenge</span><span class="hl-0"> Challenge which tracks will be checked</span><br/><span class="hl-0"> */</span><br/><span class="hl-1">export</span><span class="hl-2"> </span><span class="hl-3">async</span><span class="hl-2"> </span><span class="hl-3">function</span><span class="hl-2"> </span><span class="hl-8">checkItemsExists</span><span class="hl-2">(</span><span class="hl-5">challenge</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-0">// Comprobar que los tracks existen en la base de datos.</span><br/><span class="hl-2">  </span><span class="hl-1">for</span><span class="hl-2"> (</span><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-5">i</span><span class="hl-2"> = </span><span class="hl-12">0</span><span class="hl-2">; </span><span class="hl-5">i</span><span class="hl-2"> &lt; </span><span class="hl-5">challenge</span><span class="hl-2">.</span><span class="hl-5">tracks</span><span class="hl-2">.</span><span class="hl-5">length</span><span class="hl-2">; </span><span class="hl-5">i</span><span class="hl-2">++) {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">checkTrack</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">Track</span><span class="hl-2">.</span><span class="hl-8">findById</span><span class="hl-2">(</span><span class="hl-5">challenge</span><span class="hl-2">.</span><span class="hl-5">tracks</span><span class="hl-2">[</span><span class="hl-5">i</span><span class="hl-2">]);</span><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">checkTrack</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Error</span><span class="hl-2">(</span><span class="hl-6">&quot;Any track is not in the database&quot;</span><span class="hl-2">)</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * When a challenge is deleted, this is deleted in the rest of the items that include it.</span><br/><span class="hl-0"> * </span><span class="hl-3">@param</span><span class="hl-0"> </span><span class="hl-5">challenge</span><span class="hl-0"> Challenge that will be deleted in the rest of the items.</span><br/><span class="hl-0"> */</span><br/><span class="hl-1">export</span><span class="hl-2"> </span><span class="hl-3">async</span><span class="hl-2"> </span><span class="hl-3">function</span><span class="hl-2"> </span><span class="hl-8">deleteInOtherObjects</span><span class="hl-2">(</span><span class="hl-5">challenge</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-0">// Cuando se elimina un reto, también lo hace de los retos activos del usuario.</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">challengeUser</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">User</span><span class="hl-2">.</span><span class="hl-8">find</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-5">activeChallenges:</span><span class="hl-2"> </span><span class="hl-5">challenge</span><span class="hl-2">.</span><span class="hl-5">_id</span><br/><span class="hl-2">  });</span><br/><span class="hl-2">      </span><br/><span class="hl-2">  </span><span class="hl-5">challengeUser</span><span class="hl-2">.</span><span class="hl-8">forEach</span><span class="hl-2">(</span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">item</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">index</span><span class="hl-2"> = </span><span class="hl-5">item</span><span class="hl-2">.</span><span class="hl-5">activeChallenges</span><span class="hl-2">.</span><span class="hl-8">indexOf</span><span class="hl-2">(</span><span class="hl-5">challenge</span><span class="hl-2">.</span><span class="hl-5">_id</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-5">index</span><span class="hl-2"> &gt; -</span><span class="hl-12">1</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-5">item</span><span class="hl-2">.</span><span class="hl-5">activeChallenges</span><span class="hl-2">.</span><span class="hl-8">splice</span><span class="hl-2">(</span><span class="hl-5">index</span><span class="hl-2">, </span><span class="hl-12">1</span><span class="hl-2">);</span><br/><span class="hl-2">      </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">item</span><span class="hl-2">.</span><span class="hl-8">save</span><span class="hl-2">();</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  });</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Get all the challenges in the database or only one if the query string name exists</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">challengeRouter</span><span class="hl-2">.</span><span class="hl-8">get</span><span class="hl-2">(</span><span class="hl-6">&#39;/&#39;</span><span class="hl-2">,  </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">filter</span><span class="hl-2"> = </span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">query</span><span class="hl-2">.</span><span class="hl-5">name</span><span class="hl-2">?{</span><span class="hl-5">name:</span><span class="hl-2"> </span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">query</span><span class="hl-2">.</span><span class="hl-5">name</span><span class="hl-2">.</span><span class="hl-8">toString</span><span class="hl-2">()}:{};</span><br/><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">challenge</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">Challenge</span><span class="hl-2">.</span><span class="hl-8">find</span><span class="hl-2">(</span><span class="hl-5">filter</span><span class="hl-2">);</span><br/><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-5">challenge</span><span class="hl-2">.</span><span class="hl-5">length</span><span class="hl-2"> !== </span><span class="hl-12">0</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">challenge</span><span class="hl-2">);</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">404</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">();</span><br/><span class="hl-2">  } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">error</span><span class="hl-2">);</span><br/><span class="hl-2">  }  </span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Get a specify challenge according to its ID</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">challengeRouter</span><span class="hl-2">.</span><span class="hl-8">get</span><span class="hl-2">(</span><span class="hl-6">&#39;/:id&#39;</span><span class="hl-2">, </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">challenge</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">Challenge</span><span class="hl-2">.</span><span class="hl-8">findById</span><span class="hl-2">(</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">params</span><span class="hl-2">.</span><span class="hl-5">id</span><span class="hl-2">); </span><br/><span class="hl-2">  </span><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-5">challenge</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">challenge</span><span class="hl-2">);</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">404</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">();</span><br/><span class="hl-2">  } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">error</span><span class="hl-2">);</span><br/><span class="hl-2">  } </span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Create a challenge in the database</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">challengeRouter</span><span class="hl-2">.</span><span class="hl-8">post</span><span class="hl-2">(</span><span class="hl-6">&#39;/&#39;</span><span class="hl-2">, </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">challenge</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Challenge</span><span class="hl-2">(</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">body</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-8">checkItemsExists</span><span class="hl-2">(</span><span class="hl-5">challenge</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-8">updateKms</span><span class="hl-2">(</span><span class="hl-5">challenge</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">201</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">challenge</span><span class="hl-2">);</span><br/><span class="hl-2">  } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">({</span><span class="hl-5">error:</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2">.</span><span class="hl-5">message</span><span class="hl-2">});</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Modify a challenge in the database using its name as query string</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">challengeRouter</span><span class="hl-2">.</span><span class="hl-8">patch</span><span class="hl-2">(</span><span class="hl-6">&#39;/&#39;</span><span class="hl-2">, </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">query</span><span class="hl-2">.</span><span class="hl-5">name</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">400</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-5">error:</span><span class="hl-2"> </span><span class="hl-6">&#39;A challenge name must be provided&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">    });</span><br/><span class="hl-2">  } </span><br/><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">allowedUpdates</span><span class="hl-2"> = [</span><span class="hl-6">&#39;name&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;tracks&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;activity&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;users&#39;</span><span class="hl-2">];</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">actualUpdates</span><span class="hl-2"> = </span><span class="hl-5">Object</span><span class="hl-2">.</span><span class="hl-8">keys</span><span class="hl-2">(</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">body</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">isValidUpdate</span><span class="hl-2"> = </span><span class="hl-5">actualUpdates</span><span class="hl-2">.</span><span class="hl-8">every</span><span class="hl-2">((</span><span class="hl-5">update</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-5">allowedUpdates</span><span class="hl-2">.</span><span class="hl-8">includes</span><span class="hl-2">(</span><span class="hl-5">update</span><span class="hl-2">));</span><br/><br/><span class="hl-2">  </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">isValidUpdate</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">400</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-5">error:</span><span class="hl-2"> </span><span class="hl-6">&#39;Update is not permitted&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">    });</span><br/><span class="hl-2">  }</span><br/><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">challenge</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">Challenge</span><span class="hl-2">.</span><span class="hl-8">findOneAndUpdate</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-5">name:</span><span class="hl-2"> </span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">query</span><span class="hl-2">.</span><span class="hl-5">name</span><span class="hl-2">.</span><span class="hl-8">toString</span><span class="hl-2">()</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">    </span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">body</span><span class="hl-2">,</span><br/><span class="hl-2">    {</span><br/><span class="hl-2">      </span><span class="hl-5">new:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-5">runValidators:</span><span class="hl-2"> </span><span class="hl-3">true</span><br/><span class="hl-2">    });</span><br/><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-5">challenge</span><span class="hl-2">) { </span><br/><span class="hl-2">       </span><br/><span class="hl-2">      </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-8">checkItemsExists</span><span class="hl-2">(</span><span class="hl-5">challenge</span><span class="hl-2">);</span><br/><span class="hl-2">      </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-8">updateKms</span><span class="hl-2">(</span><span class="hl-5">challenge</span><span class="hl-2">);  </span><br/><span class="hl-2">      </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">challenge</span><span class="hl-2">);</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">404</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">();</span><br/><span class="hl-2">  } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">({</span><span class="hl-5">error:</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2">.</span><span class="hl-5">message</span><span class="hl-2">});</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Modify a challenge in the database using its ID</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">challengeRouter</span><span class="hl-2">.</span><span class="hl-8">patch</span><span class="hl-2">(</span><span class="hl-6">&#39;/:id&#39;</span><span class="hl-2">, </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {  </span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">allowedUpdates</span><span class="hl-2"> = [</span><span class="hl-6">&#39;name&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;tracks&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;activity&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;users&#39;</span><span class="hl-2">];</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">actualUpdates</span><span class="hl-2"> = </span><span class="hl-5">Object</span><span class="hl-2">.</span><span class="hl-8">keys</span><span class="hl-2">(</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">body</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">isValidUpdate</span><span class="hl-2"> = </span><span class="hl-5">actualUpdates</span><span class="hl-2">.</span><span class="hl-8">every</span><span class="hl-2">((</span><span class="hl-5">update</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-5">allowedUpdates</span><span class="hl-2">.</span><span class="hl-8">includes</span><span class="hl-2">(</span><span class="hl-5">update</span><span class="hl-2">));</span><br/><br/><span class="hl-2">  </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">isValidUpdate</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">400</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-5">error:</span><span class="hl-2"> </span><span class="hl-6">&#39;Update is not permitted&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">    });</span><br/><span class="hl-2">  }</span><br/><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">challenge</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">Challenge</span><span class="hl-2">.</span><span class="hl-8">findByIdAndUpdate</span><span class="hl-2">(</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">params</span><span class="hl-2">.</span><span class="hl-5">id</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">body</span><span class="hl-2">,</span><br/><span class="hl-2">    {</span><br/><span class="hl-2">      </span><span class="hl-5">new:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-5">runValidators:</span><span class="hl-2"> </span><span class="hl-3">true</span><br/><span class="hl-2">    });</span><br/><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-5">challenge</span><span class="hl-2">) {</span><br/><br/><span class="hl-2">      </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-8">checkItemsExists</span><span class="hl-2">(</span><span class="hl-5">challenge</span><span class="hl-2">);</span><br/><span class="hl-2">      </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-8">updateKms</span><span class="hl-2">(</span><span class="hl-5">challenge</span><span class="hl-2">);  </span><br/><span class="hl-2">      </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">challenge</span><span class="hl-2">);</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">404</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">();</span><br/><span class="hl-2">  } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">({</span><span class="hl-5">error:</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2">.</span><span class="hl-5">message</span><span class="hl-2">});</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Delete a challenge in the database using its name as query string</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">challengeRouter</span><span class="hl-2">.</span><span class="hl-8">delete</span><span class="hl-2">(</span><span class="hl-6">&#39;/&#39;</span><span class="hl-2">, </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">query</span><span class="hl-2">.</span><span class="hl-5">name</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">400</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-5">error:</span><span class="hl-2"> </span><span class="hl-6">&#39;A challenge name must be provided&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">    });</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">challenge</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">Challenge</span><span class="hl-2">.</span><span class="hl-8">findOneAndDelete</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-5">name:</span><span class="hl-2"> </span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">query</span><span class="hl-2">.</span><span class="hl-5">name</span><span class="hl-2">.</span><span class="hl-8">toString</span><span class="hl-2">(),</span><br/><span class="hl-2">    });</span><br/><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">challenge</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">404</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">();</span><br/><span class="hl-2">    } </span><span class="hl-1">else</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">challenge</span><span class="hl-2">);</span><br/><span class="hl-2">    }</span><br/><br/><span class="hl-2">    </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-8">deleteInOtherObjects</span><span class="hl-2">(</span><span class="hl-5">challenge</span><span class="hl-2">);</span><br/><br/><span class="hl-2">  } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">error</span><span class="hl-2">);</span><br/><span class="hl-2">  }  </span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Delete a challenge in the database using its ID</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">challengeRouter</span><span class="hl-2">.</span><span class="hl-8">delete</span><span class="hl-2">(</span><span class="hl-6">&#39;/:id&#39;</span><span class="hl-2">, </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">challenge</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">Challenge</span><span class="hl-2">.</span><span class="hl-8">findByIdAndDelete</span><span class="hl-2">(</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">params</span><span class="hl-2">.</span><span class="hl-5">id</span><span class="hl-2">);</span><br/><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">challenge</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">404</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">();</span><br/><span class="hl-2">    } </span><span class="hl-1">else</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">challenge</span><span class="hl-2">);</span><br/><span class="hl-2">    }</span><br/><br/><span class="hl-2">    </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-8">deleteInOtherObjects</span><span class="hl-2">(</span><span class="hl-5">challenge</span><span class="hl-2">);</span><br/><br/><span class="hl-2">  } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">error</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">});</span>
</code></pre>
<p>La primera función que encontramos es <em>updateKms</em>, que se encarga de actualizar los kilómetros de un reto. Para ello, se recorre el array de tracks del reto y se van sumando los kilómetros de cada uno de ellos. Una vez se ha terminado de recorrer el array, se actualiza el campo <em>kms</em> del reto con el valor obtenido.
<br><br>La siguiente función es <em>checkItemsExists</em>, que se encarga de comprobar que que los tracks de un challenge existen en la base de datos. En caso de que no exista alguno, se lanza un error.
<br><br>Tambien tememos <em>deleteInOtherObjects</em>, que se encarga de eliminar el reto de los usuarios que lo tienen como reto activo.
<br><br>A continuación tenemos las operaciones a través de los métodos HTTP:</p>
<ul>
<li><em>GET /challenges</em>: Devuelve todos los retos de la base de datos o uno en concreto si se le pasa el nombre como <strong>query string</strong>. También se puede consultar un reto a través de su ID haciendo uso de la ruta <em>/challenges/:id</em>.</li>
<li><em>POST /challenges</em>: Crea un nuevo reto en la base de datos tal y como se ha explicado anteriormente.</li>
<li><em>PATCH /challenges</em>: Modifica un reto en la base de datos a través de su nombre como <strong>query string</strong>. También se puede modificar un reto a través de su ID haciendo uso de la ruta <em>/challenges/:id</em>. En ambos casos, se pueden modificar los campos <em>name</em>, <em>tracks</em>, <em>activity</em> y <em>users</em>. Si se intenta modificar un campo que no es uno de los mencionados, se lanzará un error.</li>
<li><em>DELETE /challenges</em>: Elimina un reto en la base de datos a través de su nombre como <strong>query string</strong>. También se puede eliminar un reto a través de su ID haciendo uso de la ruta <em>/challenges/:id</em>. En ambos casos, se eliminará el reto de la base de datos y se eliminará de los usuarios que lo tengan como reto activo.</li>
</ul>
<p>Las pruebas llevadas a cabo para <em>Challenges</em> son las siguientes:</p>
<pre><code><span class="hl-7">POST</span><span class="hl-2"> /</span><span class="hl-5">challenges</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-5">create</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">challenge</span><span class="hl-2"> (66</span><span class="hl-5">ms</span><span class="hl-2">)</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-5">create</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-5">challenge</span><span class="hl-2"> </span><span class="hl-5">with</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">correct</span><span class="hl-2"> </span><span class="hl-5">number</span><span class="hl-2"> </span><span class="hl-3">of</span><span class="hl-2"> </span><span class="hl-5">Kms</span><span class="hl-2"> </span><span class="hl-5">adding</span><span class="hl-2"> </span><span class="hl-5">their</span><span class="hl-2"> </span><span class="hl-5">tracks</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">when</span><span class="hl-2"> </span><span class="hl-5">creating</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">challenge</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">name</span><span class="hl-2"> </span><span class="hl-5">is</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">according</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-8">validator</span><span class="hl-2"> (</span><span class="hl-5">Uso</span><span class="hl-2"> </span><span class="hl-5">characters</span><span class="hl-2"> </span><span class="hl-5">that</span><span class="hl-2"> </span><span class="hl-5">are</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">alphanumeric</span><span class="hl-2">)</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">when</span><span class="hl-2"> </span><span class="hl-5">creating</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">challenge</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">track</span><span class="hl-2"> </span><span class="hl-5">is</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-3">in</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">database</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">when</span><span class="hl-2"> </span><span class="hl-5">creating</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">challenge</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">activity</span><span class="hl-2"> </span><span class="hl-5">is</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">according</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-8">validator</span><span class="hl-2"> (</span><span class="hl-5">only</span><span class="hl-2"> </span><span class="hl-5">can</span><span class="hl-2"> </span><span class="hl-5">be</span><span class="hl-2"> </span><span class="hl-5">running</span><span class="hl-2"> </span><span class="hl-5">or</span><span class="hl-2"> </span><span class="hl-5">bike</span><span class="hl-2">)</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">when</span><span class="hl-2"> </span><span class="hl-5">creating</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">challenge</span><br/><br/><span class="hl-2">  </span><span class="hl-7">GET</span><span class="hl-2"> /</span><span class="hl-5">challenges</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-5">get</span><span class="hl-2"> </span><span class="hl-5">all</span><span class="hl-2"> </span><span class="hl-5">challenges</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-5">consult</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">specific</span><span class="hl-2"> </span><span class="hl-5">challenge</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-5">consult</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">specific</span><span class="hl-2"> </span><span class="hl-5">challenge</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">find</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">challenge</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">find</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">challenge</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">consult</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">invalid</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><br/><span class="hl-2">  </span><span class="hl-7">PATCH</span><span class="hl-2"> /</span><span class="hl-5">challenges</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-5">modify</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">challenge</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-5">modify</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">challenge</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">find</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">challange</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">modify</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">find</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">challange</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">modify</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">400</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">provide</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">challenge</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">400</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">update</span><span class="hl-2"> </span><span class="hl-5">is</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">permited</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">400</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">update</span><span class="hl-2"> </span><span class="hl-5">is</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">permited</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-1">do</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">invalid</span><span class="hl-2"> </span><span class="hl-5">modification</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-8">name</span><span class="hl-2"> (</span><span class="hl-5">The</span><span class="hl-2"> </span><span class="hl-5">challenge</span><span class="hl-2"> </span><span class="hl-5">name</span><span class="hl-2"> </span><span class="hl-5">must</span><span class="hl-2"> </span><span class="hl-5">start</span><span class="hl-2"> </span><span class="hl-5">with</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">capital</span><span class="hl-2"> </span><span class="hl-5">letter</span><span class="hl-2">)</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-1">do</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">invalid</span><span class="hl-2"> </span><span class="hl-5">modification</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-8">ID</span><span class="hl-2"> (</span><span class="hl-5">The</span><span class="hl-2"> </span><span class="hl-5">challenge</span><span class="hl-2"> </span><span class="hl-5">name</span><span class="hl-2"> </span><span class="hl-5">must</span><span class="hl-2"> </span><span class="hl-5">start</span><span class="hl-2"> </span><span class="hl-5">with</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">capital</span><span class="hl-2"> </span><span class="hl-5">letter</span><span class="hl-2">)</span><br/><br/><span class="hl-2">  </span><span class="hl-7">DELETE</span><span class="hl-2"> /</span><span class="hl-5">challenges</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-3">delete</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">challenge</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-3">delete</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">challenge</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">find</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">challenge</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-3">delete</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">find</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">challenge</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-3">delete</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-1">try</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-3">delete</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">challenge</span><span class="hl-2"> </span><span class="hl-1">with</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">invalid</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-3">delete</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">challenge</span><span class="hl-2"> </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">active</span><span class="hl-2"> </span><span class="hl-5">challenge</span><span class="hl-2"> </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-5">user</span>
</code></pre>

<a href="#users" id="users" style="color: inherit; text-decoration: none;">
  <h3>Users</h3>
</a>
<pre><code class="language-Typescript"><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Check if an item exists in the database when its ID is going to use for create/modify a user, in this case the tracks, users and challenges.</span><br/><span class="hl-0"> * </span><span class="hl-3">@param</span><span class="hl-0"> </span><span class="hl-5">user</span><span class="hl-0"> User which tracks, users and challenges will be checked</span><br/><span class="hl-0"> */</span><br/><span class="hl-1">export</span><span class="hl-2"> </span><span class="hl-3">async</span><span class="hl-2"> </span><span class="hl-3">function</span><span class="hl-2"> </span><span class="hl-8">checkItemsExists</span><span class="hl-2">(</span><span class="hl-5">user</span><span class="hl-2">) {</span><br/><br/><span class="hl-2">  </span><span class="hl-0">// Comprobar que los amigos existen en la base de datos.</span><br/><span class="hl-2">  </span><span class="hl-1">for</span><span class="hl-2"> (</span><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-5">i</span><span class="hl-2"> = </span><span class="hl-12">0</span><span class="hl-2">; </span><span class="hl-5">i</span><span class="hl-2"> &lt; </span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">friends</span><span class="hl-2">.</span><span class="hl-5">length</span><span class="hl-2">; </span><span class="hl-5">i</span><span class="hl-2">++) {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">checkUser</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">User</span><span class="hl-2">.</span><span class="hl-8">findById</span><span class="hl-2">(</span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">friends</span><span class="hl-2">[</span><span class="hl-5">i</span><span class="hl-2">]);</span><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">checkUser</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Error</span><span class="hl-2">(</span><span class="hl-6">&quot;Any friend is not in the database&quot;</span><span class="hl-2">)      </span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  }</span><br/><br/><span class="hl-2">  </span><span class="hl-0">// Comprobar que los amigos dentro de grupo de amigos existen en la base de datos.</span><br/><span class="hl-2">  </span><span class="hl-1">for</span><span class="hl-2"> (</span><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-5">i</span><span class="hl-2"> = </span><span class="hl-12">0</span><span class="hl-2">; </span><span class="hl-5">i</span><span class="hl-2"> &lt; </span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">friendsGroups</span><span class="hl-2">.</span><span class="hl-5">length</span><span class="hl-2">; </span><span class="hl-5">i</span><span class="hl-2">++) {</span><br/><span class="hl-2">    </span><span class="hl-1">for</span><span class="hl-2"> (</span><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-5">j</span><span class="hl-2"> = </span><span class="hl-12">0</span><span class="hl-2">; </span><span class="hl-5">j</span><span class="hl-2"> &lt; </span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">friendsGroups</span><span class="hl-2">[</span><span class="hl-5">i</span><span class="hl-2">].</span><span class="hl-5">friends</span><span class="hl-2">.</span><span class="hl-5">length</span><span class="hl-2">; </span><span class="hl-5">j</span><span class="hl-2">++) {</span><br/><span class="hl-2">      </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">checkUser</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">User</span><span class="hl-2">.</span><span class="hl-8">findById</span><span class="hl-2">(</span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">friendsGroups</span><span class="hl-2">[</span><span class="hl-5">i</span><span class="hl-2">].</span><span class="hl-5">friends</span><span class="hl-2">[</span><span class="hl-5">j</span><span class="hl-2">]);</span><br/><span class="hl-2">      </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">checkUser</span><span class="hl-2">) {</span><br/><span class="hl-2">        </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Error</span><span class="hl-2">(</span><span class="hl-6">&quot;Any friend in friendsGroup is not in the database&quot;</span><span class="hl-2">)            </span><br/><span class="hl-2">      }</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  }</span><br/><br/><span class="hl-2">  </span><span class="hl-0">// Comprobar que las rutas favoritas del usuario existen en la base de datos.</span><br/><span class="hl-2">  </span><span class="hl-1">for</span><span class="hl-2"> (</span><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-5">i</span><span class="hl-2"> = </span><span class="hl-12">0</span><span class="hl-2">; </span><span class="hl-5">i</span><span class="hl-2"> &lt; </span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">favoriteTracks</span><span class="hl-2">.</span><span class="hl-5">length</span><span class="hl-2">; </span><span class="hl-5">i</span><span class="hl-2">++) {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">checkTrack</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">Track</span><span class="hl-2">.</span><span class="hl-8">findById</span><span class="hl-2">(</span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">favoriteTracks</span><span class="hl-2">[</span><span class="hl-5">i</span><span class="hl-2">]);</span><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">checkTrack</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Error</span><span class="hl-2">(</span><span class="hl-6">&quot;Any track in favoriteTracks is not in the database&quot;</span><span class="hl-2">)           </span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  }</span><br/><br/><span class="hl-2">  </span><span class="hl-0">// Comprobar que los retos activos del usuario existen en la base de datos.</span><br/><span class="hl-2">  </span><span class="hl-1">for</span><span class="hl-2"> (</span><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-5">i</span><span class="hl-2"> = </span><span class="hl-12">0</span><span class="hl-2">; </span><span class="hl-5">i</span><span class="hl-2"> &lt; </span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">activeChallenges</span><span class="hl-2">.</span><span class="hl-5">length</span><span class="hl-2">; </span><span class="hl-5">i</span><span class="hl-2">++) {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">checkChallenge</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">Challenge</span><span class="hl-2">.</span><span class="hl-8">findById</span><span class="hl-2">(</span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">activeChallenges</span><span class="hl-2">[</span><span class="hl-5">i</span><span class="hl-2">]);</span><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">checkChallenge</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Error</span><span class="hl-2">(</span><span class="hl-6">&quot;Any challenge in activeChallenges is not in the database&quot;</span><span class="hl-2">)        </span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  }</span><br/><br/><span class="hl-2">  </span><span class="hl-0">// Comprobar que las rutas dentro del historial de rutas existen en la base de datos.</span><br/><span class="hl-2">  </span><span class="hl-1">for</span><span class="hl-2"> (</span><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-5">i</span><span class="hl-2"> = </span><span class="hl-12">0</span><span class="hl-2">; </span><span class="hl-5">i</span><span class="hl-2"> &lt; </span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">trackHistory</span><span class="hl-2">.</span><span class="hl-5">length</span><span class="hl-2">; </span><span class="hl-5">i</span><span class="hl-2">++) {</span><br/><span class="hl-2">    </span><span class="hl-1">for</span><span class="hl-2"> (</span><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-5">j</span><span class="hl-2"> = </span><span class="hl-12">0</span><span class="hl-2">; </span><span class="hl-5">j</span><span class="hl-2"> &lt; </span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">trackHistory</span><span class="hl-2">[</span><span class="hl-5">i</span><span class="hl-2">].</span><span class="hl-5">tracks</span><span class="hl-2">.</span><span class="hl-5">length</span><span class="hl-2">; </span><span class="hl-5">j</span><span class="hl-2">++) {</span><br/><span class="hl-2">      </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">checkTrack</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">Track</span><span class="hl-2">.</span><span class="hl-8">findById</span><span class="hl-2">(</span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">trackHistory</span><span class="hl-2">[</span><span class="hl-5">i</span><span class="hl-2">].</span><span class="hl-5">tracks</span><span class="hl-2">[</span><span class="hl-5">j</span><span class="hl-2">]);</span><br/><span class="hl-2">      </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">checkTrack</span><span class="hl-2">) {</span><br/><span class="hl-2">        </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Error</span><span class="hl-2">(</span><span class="hl-6">&quot;Any track in trackHistory is not in the database&quot;</span><span class="hl-2">)        </span><br/><span class="hl-2">      }</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * When a user is deleted, this is deleted in the rest of the items that include it.</span><br/><span class="hl-0"> * </span><span class="hl-3">@param</span><span class="hl-0"> </span><span class="hl-5">user</span><span class="hl-0"> User that will be deleted in the rest of the items.</span><br/><span class="hl-0"> */</span><br/><span class="hl-1">export</span><span class="hl-2"> </span><span class="hl-3">async</span><span class="hl-2"> </span><span class="hl-3">function</span><span class="hl-2"> </span><span class="hl-8">deleteInOtherObjects</span><span class="hl-2">(</span><span class="hl-5">user</span><span class="hl-2">) {</span><br/><br/><span class="hl-2">  </span><span class="hl-0">// Cuando se elimina un usuario también lo hace de los grupos a los que pertenezca.</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">userGroup</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">Group</span><span class="hl-2">.</span><span class="hl-8">find</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-5">members:</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">_id</span><span class="hl-2">,</span><br/><span class="hl-2">  });</span><br/><span class="hl-2">      </span><br/><span class="hl-2">  </span><span class="hl-5">userGroup</span><span class="hl-2">.</span><span class="hl-8">forEach</span><span class="hl-2">(</span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">item</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">index</span><span class="hl-2"> = </span><span class="hl-5">item</span><span class="hl-2">.</span><span class="hl-5">members</span><span class="hl-2">.</span><span class="hl-8">indexOf</span><span class="hl-2">(</span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">id</span><span class="hl-2">);</span><br/><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-5">index</span><span class="hl-2"> &gt; -</span><span class="hl-12">1</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-5">item</span><span class="hl-2">.</span><span class="hl-5">members</span><span class="hl-2">.</span><span class="hl-8">splice</span><span class="hl-2">(</span><span class="hl-5">index</span><span class="hl-2">, </span><span class="hl-12">1</span><span class="hl-2">);</span><br/><span class="hl-2">      </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">item</span><span class="hl-2">.</span><span class="hl-8">save</span><span class="hl-2">();</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  });</span><br/><br/><span class="hl-2">  </span><span class="hl-0">// Cuando se elimina un usuario también lo hace de los amigos de otros usuarios.</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">userFriends</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">User</span><span class="hl-2">.</span><span class="hl-8">find</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-5">friends:</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">_id</span><span class="hl-2">,</span><br/><span class="hl-2">  });</span><br/><span class="hl-2">      </span><br/><span class="hl-2">  </span><span class="hl-5">userFriends</span><span class="hl-2">.</span><span class="hl-8">forEach</span><span class="hl-2">(</span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">item</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">index</span><span class="hl-2"> = </span><span class="hl-5">item</span><span class="hl-2">.</span><span class="hl-5">friends</span><span class="hl-2">.</span><span class="hl-8">indexOf</span><span class="hl-2">(</span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">id</span><span class="hl-2">);</span><br/><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-5">index</span><span class="hl-2"> &gt; -</span><span class="hl-12">1</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-5">item</span><span class="hl-2">.</span><span class="hl-5">friends</span><span class="hl-2">.</span><span class="hl-8">splice</span><span class="hl-2">(</span><span class="hl-5">index</span><span class="hl-2">, </span><span class="hl-12">1</span><span class="hl-2">);</span><br/><span class="hl-2">      </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">item</span><span class="hl-2">.</span><span class="hl-8">save</span><span class="hl-2">();</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  });</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Get all the users in the database or only one if the query string name exists</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">userRouter</span><span class="hl-2">.</span><span class="hl-8">get</span><span class="hl-2">(</span><span class="hl-6">&#39;/&#39;</span><span class="hl-2">, </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">filter</span><span class="hl-2"> = </span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">query</span><span class="hl-2">.</span><span class="hl-5">name</span><span class="hl-2">?{</span><span class="hl-5">name:</span><span class="hl-2"> </span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">query</span><span class="hl-2">.</span><span class="hl-5">name</span><span class="hl-2">.</span><span class="hl-8">toString</span><span class="hl-2">()}:{};</span><br/><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">users</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">User</span><span class="hl-2">.</span><span class="hl-8">find</span><span class="hl-2">(</span><span class="hl-5">filter</span><span class="hl-2">);</span><br/><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-5">users</span><span class="hl-2">.</span><span class="hl-5">length</span><span class="hl-2"> !== </span><span class="hl-12">0</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">users</span><span class="hl-2">);</span><br/><span class="hl-2">    }    </span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">404</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">();    </span><br/><span class="hl-2">  } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">error</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Get a specify user according to its ID</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">userRouter</span><span class="hl-2">.</span><span class="hl-8">get</span><span class="hl-2">(</span><span class="hl-6">&#39;/:id&#39;</span><span class="hl-2">, </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">user</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">User</span><span class="hl-2">.</span><span class="hl-8">findById</span><span class="hl-2">(</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">params</span><span class="hl-2">.</span><span class="hl-5">id</span><span class="hl-2">);</span><br/><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-5">user</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">user</span><span class="hl-2">);</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">404</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">();    </span><br/><span class="hl-2">  } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">error</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Create a user in the database</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">userRouter</span><span class="hl-2">.</span><span class="hl-8">post</span><span class="hl-2">(</span><span class="hl-6">&#39;/&#39;</span><span class="hl-2">, </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">user</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">User</span><span class="hl-2">(</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">body</span><span class="hl-2">);</span><br/><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-8">checkItemsExists</span><span class="hl-2">(</span><span class="hl-5">user</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-8">save</span><span class="hl-2">();</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">201</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">user</span><span class="hl-2">);</span><br/><span class="hl-2">  } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">({</span><span class="hl-5">error:</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2">.</span><span class="hl-5">message</span><span class="hl-2">});</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Modify a user in the database using its name as query string</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">userRouter</span><span class="hl-2">.</span><span class="hl-8">patch</span><span class="hl-2">(</span><span class="hl-6">&#39;/&#39;</span><span class="hl-2">, </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">query</span><span class="hl-2">.</span><span class="hl-5">name</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">400</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-5">error:</span><span class="hl-2"> </span><span class="hl-6">&#39;A user name must be provided&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">    });</span><br/><span class="hl-2">  }</span><br/><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">allowedUpdates</span><span class="hl-2"> = [</span><span class="hl-6">&#39;name&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;activity&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;friends&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;friendsGroups&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;trainingStats&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;favoriteTracks&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;activeChallenges&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;trackHistory&#39;</span><span class="hl-2">];</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">actualUpdates</span><span class="hl-2"> = </span><span class="hl-5">Object</span><span class="hl-2">.</span><span class="hl-8">keys</span><span class="hl-2">(</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">body</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">isValidUpdate</span><span class="hl-2"> = </span><span class="hl-5">actualUpdates</span><span class="hl-2">.</span><span class="hl-8">every</span><span class="hl-2">((</span><span class="hl-5">update</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-5">allowedUpdates</span><span class="hl-2">.</span><span class="hl-8">includes</span><span class="hl-2">(</span><span class="hl-5">update</span><span class="hl-2">));</span><br/><br/><span class="hl-2">  </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">isValidUpdate</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">400</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-5">error:</span><span class="hl-2"> </span><span class="hl-6">&#39;Update is not permitted&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">    });</span><br/><span class="hl-2">  }</span><br/><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">user</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">User</span><span class="hl-2">.</span><span class="hl-8">findOneAndUpdate</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-5">name:</span><span class="hl-2"> </span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">query</span><span class="hl-2">.</span><span class="hl-5">name</span><span class="hl-2">.</span><span class="hl-8">toString</span><span class="hl-2">()</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">    </span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">body</span><span class="hl-2">,</span><br/><span class="hl-2">    { </span><br/><span class="hl-2">      </span><span class="hl-5">new:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-5">runValidators:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2"> }</span><br/><span class="hl-2">    );</span><br/><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-5">user</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-8">checkItemsExists</span><span class="hl-2">(</span><span class="hl-5">user</span><span class="hl-2">);</span><br/><span class="hl-2">      </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">user</span><span class="hl-2">);</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">404</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">();</span><br/><span class="hl-2">  } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">({</span><span class="hl-5">error:</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2">.</span><span class="hl-5">message</span><span class="hl-2">});</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Modify a user in the database using its ID</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">userRouter</span><span class="hl-2">.</span><span class="hl-8">patch</span><span class="hl-2">(</span><span class="hl-6">&#39;/:id&#39;</span><span class="hl-2">, </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">allowedUpdates</span><span class="hl-2"> = [</span><span class="hl-6">&#39;name&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;activity&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;friends&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;friendsGroups&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;trainingStats&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;favoriteTracks&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;activeChallenges&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;trackHistory&#39;</span><span class="hl-2">];</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">actualUpdates</span><span class="hl-2"> = </span><span class="hl-5">Object</span><span class="hl-2">.</span><span class="hl-8">keys</span><span class="hl-2">(</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">body</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">isValidUpdate</span><span class="hl-2"> = </span><span class="hl-5">actualUpdates</span><span class="hl-2">.</span><span class="hl-8">every</span><span class="hl-2">((</span><span class="hl-5">update</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-5">allowedUpdates</span><span class="hl-2">.</span><span class="hl-8">includes</span><span class="hl-2">(</span><span class="hl-5">update</span><span class="hl-2">));</span><br/><br/><span class="hl-2">  </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">isValidUpdate</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">400</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-5">error:</span><span class="hl-2"> </span><span class="hl-6">&quot;Update is not permitted&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">    });</span><br/><span class="hl-2">  }</span><br/><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">user</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">User</span><span class="hl-2">.</span><span class="hl-8">findByIdAndUpdate</span><span class="hl-2">(</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">params</span><span class="hl-2">.</span><span class="hl-5">id</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">body</span><span class="hl-2">,</span><br/><span class="hl-2">    {</span><br/><span class="hl-2">      </span><span class="hl-5">new:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-5">runValidators:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">    });</span><br/><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-5">user</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-8">checkItemsExists</span><span class="hl-2">(</span><span class="hl-5">user</span><span class="hl-2">);</span><br/><span class="hl-2">      </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">user</span><span class="hl-2">);</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">404</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">();</span><br/><span class="hl-2">  } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">({</span><span class="hl-5">error:</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2">.</span><span class="hl-5">message</span><span class="hl-2">});</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Delete a user in the database using its name as query string</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">userRouter</span><span class="hl-2">.</span><span class="hl-8">delete</span><span class="hl-2">(</span><span class="hl-6">&#39;/&#39;</span><span class="hl-2">, </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">query</span><span class="hl-2">.</span><span class="hl-5">name</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">400</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-5">error:</span><span class="hl-2"> </span><span class="hl-6">&#39;A user name must be provided&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">    });</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">user</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">User</span><span class="hl-2">.</span><span class="hl-8">findOneAndDelete</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-5">name:</span><span class="hl-2"> </span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">query</span><span class="hl-2">.</span><span class="hl-5">name</span><span class="hl-2">.</span><span class="hl-8">toString</span><span class="hl-2">(),</span><br/><span class="hl-2">    });</span><br/><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">user</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">404</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">();</span><br/><span class="hl-2">    } </span><span class="hl-1">else</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">user</span><span class="hl-2">);</span><br/><span class="hl-2">    } </span><br/><br/><span class="hl-2">    </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-8">deleteInOtherObjects</span><span class="hl-2">(</span><span class="hl-5">user</span><span class="hl-2">);</span><br/><br/><span class="hl-2">    } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">error</span><span class="hl-2">);</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Delete a user in the database using its ID</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">userRouter</span><span class="hl-2">.</span><span class="hl-8">delete</span><span class="hl-2">(</span><span class="hl-6">&quot;/:id&quot;</span><span class="hl-2">, </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">user</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">User</span><span class="hl-2">.</span><span class="hl-8">findByIdAndDelete</span><span class="hl-2">(</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">params</span><span class="hl-2">.</span><span class="hl-5">id</span><span class="hl-2">);</span><br/><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">user</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">404</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">();</span><br/><span class="hl-2">    } </span><span class="hl-1">else</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">user</span><span class="hl-2">);</span><br/><span class="hl-2">    }</span><br/><br/><span class="hl-2">    </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-8">deleteInOtherObjects</span><span class="hl-2">(</span><span class="hl-5">user</span><span class="hl-2">);</span><br/><br/><span class="hl-2">  } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">){</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">error</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">});</span>
</code></pre>
<p>Tenemos como primera función al igual que en <em>challengeRouter</em> la función <em>checkItemsExists</em> que se encarga de comprobar que los elementos que se quieren añadir al usuario existen en la base de datos. Comprobamos que existan los amigos, los amigos dentro de los
grupos de amigos, las rutas favoritas, los retos activos y las rutas del historial de rutas. En caso de que no exista alguno de estos elementos se lanza un error indicando que el elemento no existe en la base de datos.
<br><br>Tambien tenemos <em>deleteInOtherObjects</em> que se encarga de eliminar el usuario de los elementos que lo contienen.
<br><br>A continuación tenemos las operaciones a través de los métodos HTTP:</p>
<ul>
<li><em>GET /users</em>: Devuelve todos los usuarios de la base de datos. Si usamos el query string <em>name</em> devuelve el usuario con ese nombre.</li>
<li><em>GET /users/:id</em>: Devuelve un usuario de la base de datos a través de su ID.</li>
<li><em>POST /users</em>: Crea un usuario en la base de datos.</li>
<li><em>PATCH /users</em>: Modifica un usuario en la base de datos a través de su nombre.</li>
<li><em>PATCH /users/:id</em>: Modifica un usuario en la base de datos a través de su ID.</li>
<li><em>DELETE /users</em>: Elimina un usuario en la base de datos a través de su nombre.</li>
<li><em>DELETE /users/:id</em>: Elimina un usuario en la base de datos a través de su ID.
<br><br>Las pruebas llevadas a cabo para <em>Users</em> son las siguientes:</li>
</ul>
<pre><code><span class="hl-7">POST</span><span class="hl-2"> /</span><span class="hl-5">users</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-5">create</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-5">user</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">when</span><span class="hl-2"> </span><span class="hl-5">creating</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">name</span><span class="hl-2"> </span><span class="hl-5">is</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">according</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-8">validator</span><span class="hl-2"> (</span><span class="hl-5">Uso</span><span class="hl-2"> </span><span class="hl-5">characters</span><span class="hl-2"> </span><span class="hl-5">that</span><span class="hl-2"> </span><span class="hl-5">are</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">alphanumeric</span><span class="hl-2">)</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">when</span><span class="hl-2"> </span><span class="hl-5">creating</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">users</span><span class="hl-2"> </span><span class="hl-3">in</span><span class="hl-2"> </span><span class="hl-5">friends</span><span class="hl-2"> </span><span class="hl-5">is</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-3">in</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">database</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">when</span><span class="hl-2"> </span><span class="hl-5">creating</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">friends</span><span class="hl-2"> </span><span class="hl-3">in</span><span class="hl-2"> </span><span class="hl-5">friendsGroup</span><span class="hl-2"> </span><span class="hl-5">is</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-3">in</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">database</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">when</span><span class="hl-2"> </span><span class="hl-5">creating</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">tracks</span><span class="hl-2"> </span><span class="hl-3">in</span><span class="hl-2"> </span><span class="hl-5">favoriteTracks</span><span class="hl-2"> </span><span class="hl-5">is</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-3">in</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">database</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">when</span><span class="hl-2"> </span><span class="hl-5">creating</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">challenge</span><span class="hl-2"> </span><span class="hl-3">in</span><span class="hl-2"> </span><span class="hl-5">activeChallenge</span><span class="hl-2"> </span><span class="hl-5">is</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-3">in</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">database</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">when</span><span class="hl-2"> </span><span class="hl-5">creating</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">tracks</span><span class="hl-2"> </span><span class="hl-3">in</span><span class="hl-2"> </span><span class="hl-5">trackHistory</span><span class="hl-2"> </span><span class="hl-5">is</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-3">in</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">database</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">when</span><span class="hl-2"> </span><span class="hl-5">creating</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">tracks</span><span class="hl-2"> </span><span class="hl-3">in</span><span class="hl-2"> </span><span class="hl-5">favoriteTracks</span><span class="hl-2"> </span><span class="hl-5">is</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-3">in</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">database</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">when</span><span class="hl-2"> </span><span class="hl-5">creating</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">activity</span><span class="hl-2"> </span><span class="hl-5">is</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">according</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-8">validator</span><span class="hl-2"> (</span><span class="hl-5">only</span><span class="hl-2"> </span><span class="hl-5">can</span><span class="hl-2"> </span><span class="hl-5">be</span><span class="hl-2"> </span><span class="hl-5">running</span><span class="hl-2"> </span><span class="hl-5">or</span><span class="hl-2"> </span><span class="hl-5">bike</span><span class="hl-2">)</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">when</span><span class="hl-2"> </span><span class="hl-5">creating</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">challenge</span><span class="hl-2">, </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">invalid</span><span class="hl-2"> </span><span class="hl-5">path</span><br/><br/><span class="hl-2">  </span><span class="hl-7">GET</span><span class="hl-2"> /</span><span class="hl-5">users</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-5">consult</span><span class="hl-2"> </span><span class="hl-5">all</span><span class="hl-2"> </span><span class="hl-5">users</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-5">consult</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">specific</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-5">consult</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">specific</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">find</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">find</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><br/><span class="hl-2">  </span><span class="hl-7">PATCH</span><span class="hl-2"> /</span><span class="hl-5">users</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-5">modify</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-5">modify</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">find</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">modify</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">find</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">modify</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">400</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">provide</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">400</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">update</span><span class="hl-2"> </span><span class="hl-5">is</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">permited</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">400</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">update</span><span class="hl-2"> </span><span class="hl-5">is</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">permited</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-1">do</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">invalid</span><span class="hl-2"> </span><span class="hl-5">modification</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-8">name</span><span class="hl-2"> (</span><span class="hl-5">The</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">name</span><span class="hl-2"> </span><span class="hl-5">must</span><span class="hl-2"> </span><span class="hl-5">start</span><span class="hl-2"> </span><span class="hl-5">with</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">capital</span><span class="hl-2"> </span><span class="hl-5">letter</span><span class="hl-2">)</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-1">do</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">invalid</span><span class="hl-2"> </span><span class="hl-5">modification</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-8">ID</span><span class="hl-2"> (</span><span class="hl-5">The</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">name</span><span class="hl-2"> </span><span class="hl-5">must</span><span class="hl-2"> </span><span class="hl-5">start</span><span class="hl-2"> </span><span class="hl-5">with</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">capital</span><span class="hl-2"> </span><span class="hl-5">letter</span><span class="hl-2">)</span><br/><br/><span class="hl-2">  </span><span class="hl-7">DELETE</span><span class="hl-2"> /</span><span class="hl-5">users</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-3">delete</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-3">delete</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">find</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-3">delete</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">find</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-3">delete</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-1">try</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-3">delete</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-1">with</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">invalid</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-3">delete</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">active</span><span class="hl-2"> </span><span class="hl-5">members</span><span class="hl-2"> </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">group</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-3">delete</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">from</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">friends</span><span class="hl-2"> </span><span class="hl-3">of</span><span class="hl-2"> </span><span class="hl-5">other</span><span class="hl-2"> </span><span class="hl-5">users</span>
</code></pre>

<a href="#groups" id="groups" style="color: inherit; text-decoration: none;">
  <h3>Groups</h3>
</a>
<pre><code class="language-Typescript"><span class="hl-0">/**</span><br/><span class="hl-0"> * Update the group stats according to the individual users stats</span><br/><span class="hl-0"> * </span><span class="hl-3">@param</span><span class="hl-0"> </span><span class="hl-5">group</span><span class="hl-0"> Group whose stats are going to be update</span><br/><span class="hl-0"> * </span><span class="hl-3">@param</span><span class="hl-0"> </span><span class="hl-5">res</span><span class="hl-0"> Response to the express server</span><br/><span class="hl-0"> * </span><span class="hl-3">@returns</span><span class="hl-0"> void</span><br/><span class="hl-0"> */</span><br/><span class="hl-1">export</span><span class="hl-2"> </span><span class="hl-3">async</span><span class="hl-2"> </span><span class="hl-3">function</span><span class="hl-2"> </span><span class="hl-8">updateStats</span><span class="hl-2">(</span><span class="hl-5">group</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-5">kmsWeekly</span><span class="hl-2"> = </span><span class="hl-12">0</span><span class="hl-2">;</span><br/><span class="hl-2">  </span><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-5">unevennessWeekly</span><span class="hl-2"> = </span><span class="hl-12">0</span><span class="hl-2">;</span><br/><span class="hl-2">  </span><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-5">kmsMonthly</span><span class="hl-2"> = </span><span class="hl-12">0</span><span class="hl-2">;</span><br/><span class="hl-2">  </span><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-5">unevennessMonthly</span><span class="hl-2"> = </span><span class="hl-12">0</span><span class="hl-2">;</span><br/><span class="hl-2">  </span><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-5">kmsYearly</span><span class="hl-2"> = </span><span class="hl-12">0</span><span class="hl-2">;</span><br/><span class="hl-2">  </span><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-5">unevennessYearly</span><span class="hl-2"> = </span><span class="hl-12">0</span><span class="hl-2">;</span><br/><br/><span class="hl-2">  </span><span class="hl-1">for</span><span class="hl-2"> (</span><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-5">i</span><span class="hl-2"> = </span><span class="hl-12">0</span><span class="hl-2">; </span><span class="hl-5">i</span><span class="hl-2"> &lt; </span><span class="hl-5">group</span><span class="hl-2">.</span><span class="hl-5">members</span><span class="hl-2">.</span><span class="hl-5">length</span><span class="hl-2">; </span><span class="hl-5">i</span><span class="hl-2">++) {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">user</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">User</span><span class="hl-2">.</span><span class="hl-8">findById</span><span class="hl-2">(</span><span class="hl-5">group</span><span class="hl-2">.</span><span class="hl-5">members</span><span class="hl-2">[</span><span class="hl-5">i</span><span class="hl-2">]);</span><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">user</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Error</span><span class="hl-2">(</span><span class="hl-6">&quot;Any user is not found&quot;</span><span class="hl-2">)</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">    </span><span class="hl-5">kmsWeekly</span><span class="hl-2"> += </span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">trainingStats</span><span class="hl-2">.</span><span class="hl-5">weekly</span><span class="hl-2">.</span><span class="hl-5">length</span><span class="hl-2">;</span><br/><span class="hl-2">    </span><span class="hl-5">unevennessWeekly</span><span class="hl-2"> += </span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">trainingStats</span><span class="hl-2">.</span><span class="hl-5">weekly</span><span class="hl-2">.</span><span class="hl-5">unevenness</span><span class="hl-2">;</span><br/><span class="hl-2">    </span><span class="hl-5">kmsMonthly</span><span class="hl-2"> += </span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">trainingStats</span><span class="hl-2">.</span><span class="hl-5">monthly</span><span class="hl-2">.</span><span class="hl-5">length</span><span class="hl-2">;</span><br/><span class="hl-2">    </span><span class="hl-5">unevennessMonthly</span><span class="hl-2"> += </span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">trainingStats</span><span class="hl-2">.</span><span class="hl-5">monthly</span><span class="hl-2">.</span><span class="hl-5">unevenness</span><span class="hl-2">;</span><br/><span class="hl-2">    </span><span class="hl-5">kmsYearly</span><span class="hl-2"> += </span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">trainingStats</span><span class="hl-2">.</span><span class="hl-5">yearly</span><span class="hl-2">.</span><span class="hl-5">length</span><span class="hl-2">;</span><br/><span class="hl-2">    </span><span class="hl-5">unevennessYearly</span><span class="hl-2"> += </span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">trainingStats</span><span class="hl-2">.</span><span class="hl-5">yearly</span><span class="hl-2">.</span><span class="hl-5">unevenness</span><span class="hl-2">;</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><span class="hl-5">group</span><span class="hl-2">.</span><span class="hl-5">groupStats</span><span class="hl-2">.</span><span class="hl-5">weekly</span><span class="hl-2">.</span><span class="hl-5">length</span><span class="hl-2"> = </span><span class="hl-5">kmsWeekly</span><span class="hl-2">;</span><br/><span class="hl-2">  </span><span class="hl-5">group</span><span class="hl-2">.</span><span class="hl-5">groupStats</span><span class="hl-2">.</span><span class="hl-5">weekly</span><span class="hl-2">.</span><span class="hl-5">unevenness</span><span class="hl-2"> = </span><span class="hl-5">unevennessWeekly</span><br/><span class="hl-2">  </span><span class="hl-5">group</span><span class="hl-2">.</span><span class="hl-5">groupStats</span><span class="hl-2">.</span><span class="hl-5">monthly</span><span class="hl-2">.</span><span class="hl-5">length</span><span class="hl-2"> = </span><span class="hl-5">kmsMonthly</span><span class="hl-2">;</span><br/><span class="hl-2">  </span><span class="hl-5">group</span><span class="hl-2">.</span><span class="hl-5">groupStats</span><span class="hl-2">.</span><span class="hl-5">monthly</span><span class="hl-2">.</span><span class="hl-5">unevenness</span><span class="hl-2"> = </span><span class="hl-5">unevennessMonthly</span><br/><span class="hl-2">  </span><span class="hl-5">group</span><span class="hl-2">.</span><span class="hl-5">groupStats</span><span class="hl-2">.</span><span class="hl-5">yearly</span><span class="hl-2">.</span><span class="hl-5">length</span><span class="hl-2"> = </span><span class="hl-5">kmsYearly</span><span class="hl-2">;</span><br/><span class="hl-2">  </span><span class="hl-5">group</span><span class="hl-2">.</span><span class="hl-5">groupStats</span><span class="hl-2">.</span><span class="hl-5">yearly</span><span class="hl-2">.</span><span class="hl-5">unevenness</span><span class="hl-2"> = </span><span class="hl-5">unevennessYearly</span><br/><span class="hl-2">  </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">group</span><span class="hl-2">.</span><span class="hl-8">save</span><span class="hl-2">();</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Sort the users that conform a group according to the kms and unevenness</span><br/><span class="hl-0"> * </span><span class="hl-3">@param</span><span class="hl-0"> </span><span class="hl-5">group</span><span class="hl-0"> The group which members will be sorted</span><br/><span class="hl-0"> */</span><br/><span class="hl-1">export</span><span class="hl-2"> </span><span class="hl-3">async</span><span class="hl-2"> </span><span class="hl-3">function</span><span class="hl-2"> </span><span class="hl-8">ranking</span><span class="hl-2">(</span><span class="hl-5">group</span><span class="hl-2">) {  </span><br/><span class="hl-2">  </span><span class="hl-3">interface</span><span class="hl-2"> </span><span class="hl-4">userValue</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-5">id</span><span class="hl-2">: </span><span class="hl-4">string</span><span class="hl-2">;</span><br/><span class="hl-2">    </span><span class="hl-5">number</span><span class="hl-2">: </span><span class="hl-4">number</span><br/><span class="hl-2">  }</span><br/><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">rankByKms</span><span class="hl-2">: </span><span class="hl-4">userValue</span><span class="hl-2">[] = [];</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">rankByUnevenness</span><span class="hl-2">: </span><span class="hl-4">userValue</span><span class="hl-2">[] = [];</span><br/><br/><span class="hl-2">  </span><span class="hl-1">for</span><span class="hl-2"> (</span><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-5">i</span><span class="hl-2"> = </span><span class="hl-12">0</span><span class="hl-2">; </span><span class="hl-5">i</span><span class="hl-2"> &lt; </span><span class="hl-5">group</span><span class="hl-2">.</span><span class="hl-5">members</span><span class="hl-2">.</span><span class="hl-5">length</span><span class="hl-2">; </span><span class="hl-5">i</span><span class="hl-2">++) {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">user</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">User</span><span class="hl-2">.</span><span class="hl-8">findById</span><span class="hl-2">(</span><span class="hl-5">group</span><span class="hl-2">.</span><span class="hl-5">members</span><span class="hl-2">[</span><span class="hl-5">i</span><span class="hl-2">]);</span><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">user</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Error</span><span class="hl-2">(</span><span class="hl-6">&quot;Any user is not found&quot;</span><span class="hl-2">)</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">    </span><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-5">kmsWeekly</span><span class="hl-2"> = </span><span class="hl-12">0</span><span class="hl-2">;</span><br/><span class="hl-2">    </span><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-5">unevennessWeekly</span><span class="hl-2"> = </span><span class="hl-12">0</span><span class="hl-2">;</span><br/><span class="hl-2">    </span><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-5">kmsMonthly</span><span class="hl-2"> = </span><span class="hl-12">0</span><span class="hl-2">;</span><br/><span class="hl-2">    </span><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-5">unevennessMonthly</span><span class="hl-2"> = </span><span class="hl-12">0</span><span class="hl-2">;</span><br/><span class="hl-2">    </span><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-5">kmsYearly</span><span class="hl-2"> = </span><span class="hl-12">0</span><span class="hl-2">;</span><br/><span class="hl-2">    </span><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-5">unevennessYearly</span><span class="hl-2"> = </span><span class="hl-12">0</span><span class="hl-2">;</span><br/><span class="hl-2">    </span><span class="hl-5">kmsWeekly</span><span class="hl-2"> += </span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">trainingStats</span><span class="hl-2">.</span><span class="hl-5">weekly</span><span class="hl-2">.</span><span class="hl-5">length</span><span class="hl-2">;</span><br/><span class="hl-2">    </span><span class="hl-5">unevennessWeekly</span><span class="hl-2"> += </span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">trainingStats</span><span class="hl-2">.</span><span class="hl-5">weekly</span><span class="hl-2">.</span><span class="hl-5">unevenness</span><span class="hl-2">;</span><br/><span class="hl-2">    </span><span class="hl-5">kmsMonthly</span><span class="hl-2"> += </span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">trainingStats</span><span class="hl-2">.</span><span class="hl-5">monthly</span><span class="hl-2">.</span><span class="hl-5">length</span><span class="hl-2">;</span><br/><span class="hl-2">    </span><span class="hl-5">unevennessMonthly</span><span class="hl-2"> += </span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">trainingStats</span><span class="hl-2">.</span><span class="hl-5">monthly</span><span class="hl-2">.</span><span class="hl-5">unevenness</span><span class="hl-2">;</span><br/><span class="hl-2">    </span><span class="hl-5">kmsYearly</span><span class="hl-2"> += </span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">trainingStats</span><span class="hl-2">.</span><span class="hl-5">yearly</span><span class="hl-2">.</span><span class="hl-5">length</span><span class="hl-2">;</span><br/><span class="hl-2">    </span><span class="hl-5">unevennessYearly</span><span class="hl-2"> += </span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">trainingStats</span><span class="hl-2">.</span><span class="hl-5">yearly</span><span class="hl-2">.</span><span class="hl-5">unevenness</span><span class="hl-2">;</span><br/><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">userKms</span><span class="hl-2"> = {</span><span class="hl-5">id:</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">id</span><span class="hl-2"> , </span><span class="hl-5">number:</span><span class="hl-2"> </span><span class="hl-5">kmsWeekly</span><span class="hl-2"> + </span><span class="hl-5">kmsMonthly</span><span class="hl-2"> + </span><span class="hl-5">kmsYearly</span><span class="hl-2">}</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">userUnevenness</span><span class="hl-2"> = {</span><span class="hl-5">id:</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2">.</span><span class="hl-5">id</span><span class="hl-2">, </span><span class="hl-5">number:</span><span class="hl-2"> </span><span class="hl-5">unevennessWeekly</span><span class="hl-2"> + </span><span class="hl-5">unevennessMonthly</span><span class="hl-2"> + </span><span class="hl-5">unevennessYearly</span><span class="hl-2">}</span><br/><br/><span class="hl-2">    </span><span class="hl-5">rankByKms</span><span class="hl-2">.</span><span class="hl-8">push</span><span class="hl-2">(</span><span class="hl-5">userKms</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-5">rankByUnevenness</span><span class="hl-2">.</span><span class="hl-8">push</span><span class="hl-2">(</span><span class="hl-5">userUnevenness</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><br/><span class="hl-2">  </span><span class="hl-5">group</span><span class="hl-2">.</span><span class="hl-5">ranking</span><span class="hl-2">.</span><span class="hl-5">byLenght</span><span class="hl-2"> = </span><span class="hl-5">rankByKms</span><span class="hl-2">.</span><span class="hl-8">sort</span><span class="hl-2">((</span><span class="hl-5">a</span><span class="hl-2">, </span><span class="hl-5">b</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-5">b</span><span class="hl-2">.</span><span class="hl-5">number</span><span class="hl-2"> - </span><span class="hl-5">a</span><span class="hl-2">.</span><span class="hl-5">number</span><span class="hl-2">).</span><span class="hl-8">map</span><span class="hl-2">(</span><span class="hl-5">item</span><span class="hl-2"> </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-5">item</span><span class="hl-2">.</span><span class="hl-5">id</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-5">group</span><span class="hl-2">.</span><span class="hl-5">ranking</span><span class="hl-2">.</span><span class="hl-5">byUnevenness</span><span class="hl-2"> = </span><span class="hl-5">rankByUnevenness</span><span class="hl-2">.</span><span class="hl-8">sort</span><span class="hl-2">((</span><span class="hl-5">a</span><span class="hl-2">, </span><span class="hl-5">b</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-5">b</span><span class="hl-2">.</span><span class="hl-5">number</span><span class="hl-2"> - </span><span class="hl-5">a</span><span class="hl-2">.</span><span class="hl-5">number</span><span class="hl-2">).</span><span class="hl-8">map</span><span class="hl-2">(</span><span class="hl-5">item</span><span class="hl-2"> </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-5">item</span><span class="hl-2">.</span><span class="hl-5">id</span><span class="hl-2">);</span><br/><br/><span class="hl-2">  </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">group</span><span class="hl-2">.</span><span class="hl-8">save</span><span class="hl-2">()</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Check if an item exists in the database when its ID is going to use for create/modify a group, in this case the tracks and the users.</span><br/><span class="hl-0"> * </span><span class="hl-3">@param</span><span class="hl-0"> </span><span class="hl-5">group</span><span class="hl-0"> Group which tracks and users will be checked</span><br/><span class="hl-0"> */</span><br/><span class="hl-1">export</span><span class="hl-2"> </span><span class="hl-3">async</span><span class="hl-2"> </span><span class="hl-3">function</span><span class="hl-2"> </span><span class="hl-8">checkItemsExists</span><span class="hl-2">(</span><span class="hl-5">group</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-0">// Comprobar que los usuarios participantes del grupo existen en la base de datos.</span><br/><span class="hl-2">  </span><span class="hl-1">for</span><span class="hl-2"> (</span><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-5">i</span><span class="hl-2"> = </span><span class="hl-12">0</span><span class="hl-2">; </span><span class="hl-5">i</span><span class="hl-2"> &lt; </span><span class="hl-5">group</span><span class="hl-2">.</span><span class="hl-5">members</span><span class="hl-2">.</span><span class="hl-5">length</span><span class="hl-2">; </span><span class="hl-5">i</span><span class="hl-2">++) {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">checkUser</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">User</span><span class="hl-2">.</span><span class="hl-8">findById</span><span class="hl-2">(</span><span class="hl-5">group</span><span class="hl-2">.</span><span class="hl-5">members</span><span class="hl-2">[</span><span class="hl-5">i</span><span class="hl-2">]);</span><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">checkUser</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Error</span><span class="hl-2">(</span><span class="hl-6">&quot;Any member is not in the database&quot;</span><span class="hl-2">)      </span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  }</span><br/><br/><span class="hl-2">  </span><span class="hl-0">// Comprobar que las rutas favoritas del grupo existen en la base de datos.</span><br/><span class="hl-2">  </span><span class="hl-1">for</span><span class="hl-2"> (</span><span class="hl-3">let</span><span class="hl-2"> </span><span class="hl-5">i</span><span class="hl-2"> = </span><span class="hl-12">0</span><span class="hl-2">; </span><span class="hl-5">i</span><span class="hl-2"> &lt; </span><span class="hl-5">group</span><span class="hl-2">.</span><span class="hl-5">favoriteTracks</span><span class="hl-2">.</span><span class="hl-5">length</span><span class="hl-2">; </span><span class="hl-5">i</span><span class="hl-2">++) {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">checkTrack</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">Track</span><span class="hl-2">.</span><span class="hl-8">findById</span><span class="hl-2">(</span><span class="hl-5">group</span><span class="hl-2">.</span><span class="hl-5">favoriteTracks</span><span class="hl-2">[</span><span class="hl-5">i</span><span class="hl-2">]);</span><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">checkTrack</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Error</span><span class="hl-2">(</span><span class="hl-6">&quot;Any track in favoriteTracks is not in the database&quot;</span><span class="hl-2">)           </span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Get all the groups in the database or only one if the query string name exists</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">groupRouter</span><span class="hl-2">.</span><span class="hl-8">get</span><span class="hl-2">(</span><span class="hl-6">&#39;/&#39;</span><span class="hl-2">, </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">filter</span><span class="hl-2"> = </span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">query</span><span class="hl-2">.</span><span class="hl-5">name</span><span class="hl-2">?{</span><span class="hl-5">name:</span><span class="hl-2"> </span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">query</span><span class="hl-2">.</span><span class="hl-5">name</span><span class="hl-2">.</span><span class="hl-8">toString</span><span class="hl-2">()}:{};</span><br/><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">groups</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">Group</span><span class="hl-2">.</span><span class="hl-8">find</span><span class="hl-2">(</span><span class="hl-5">filter</span><span class="hl-2">);</span><br/><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-5">groups</span><span class="hl-2">.</span><span class="hl-5">length</span><span class="hl-2"> !== </span><span class="hl-12">0</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">groups</span><span class="hl-2">);</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">404</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">();</span><br/><span class="hl-2">  } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">error</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Get a specify group according to its ID</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">groupRouter</span><span class="hl-2">.</span><span class="hl-8">get</span><span class="hl-2">(</span><span class="hl-6">&#39;/:id&#39;</span><span class="hl-2">, </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">group</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">Group</span><span class="hl-2">.</span><span class="hl-8">findById</span><span class="hl-2">(</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">params</span><span class="hl-2">.</span><span class="hl-5">id</span><span class="hl-2">);</span><br/><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-5">group</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">group</span><span class="hl-2">);</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">404</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">();</span><br/><span class="hl-2">  } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">error</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Create a group in the database</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">groupRouter</span><span class="hl-2">.</span><span class="hl-8">post</span><span class="hl-2">(</span><span class="hl-6">&#39;/&#39;</span><span class="hl-2">, </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">group</span><span class="hl-2"> = </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">Group</span><span class="hl-2">(</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">body</span><span class="hl-2">);</span><br/><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-8">checkItemsExists</span><span class="hl-2">(</span><span class="hl-5">group</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-8">updateStats</span><span class="hl-2">(</span><span class="hl-5">group</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-8">ranking</span><span class="hl-2">(</span><span class="hl-5">group</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">201</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">group</span><span class="hl-2">);</span><br/><span class="hl-2">  } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">({</span><span class="hl-5">error:</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2">.</span><span class="hl-5">message</span><span class="hl-2">});</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Modify a group in the database using its name as query string</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">groupRouter</span><span class="hl-2">.</span><span class="hl-8">patch</span><span class="hl-2">(</span><span class="hl-6">&#39;/&#39;</span><span class="hl-2">, </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">query</span><span class="hl-2">.</span><span class="hl-5">name</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">400</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-5">error:</span><span class="hl-2"> </span><span class="hl-6">&#39;A group name must be provided&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">    });</span><br/><span class="hl-2">  }</span><br/><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">allowedUpdates</span><span class="hl-2"> = [</span><span class="hl-6">&#39;name&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;members&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;groupStats&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;favoriteTracks&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;trackHistory&#39;</span><span class="hl-2">];</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">actualUpdates</span><span class="hl-2"> = </span><span class="hl-5">Object</span><span class="hl-2">.</span><span class="hl-8">keys</span><span class="hl-2">(</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">body</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">isValidUpdate</span><span class="hl-2"> = </span><span class="hl-5">actualUpdates</span><span class="hl-2">.</span><span class="hl-8">every</span><span class="hl-2">((</span><span class="hl-5">update</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-5">allowedUpdates</span><span class="hl-2">.</span><span class="hl-8">includes</span><span class="hl-2">(</span><span class="hl-5">update</span><span class="hl-2">));</span><br/><br/><span class="hl-2">  </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">isValidUpdate</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">400</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-5">error:</span><span class="hl-2"> </span><span class="hl-6">&#39;Update is not permitted&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">    });</span><br/><span class="hl-2">  }</span><br/><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">group</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">Group</span><span class="hl-2">.</span><span class="hl-8">findOneAndUpdate</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-5">name:</span><span class="hl-2"> </span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">query</span><span class="hl-2">.</span><span class="hl-5">name</span><span class="hl-2">.</span><span class="hl-8">toString</span><span class="hl-2">(),</span><br/><span class="hl-2">    },</span><br/><span class="hl-2">    </span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">body</span><span class="hl-2">,</span><br/><span class="hl-2">    {</span><br/><span class="hl-2">      </span><span class="hl-5">new:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-5">runValidators:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">    });</span><br/><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-5">group</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-8">checkItemsExists</span><span class="hl-2">(</span><span class="hl-5">group</span><span class="hl-2">);</span><br/><span class="hl-2">      </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-8">updateStats</span><span class="hl-2">(</span><span class="hl-5">group</span><span class="hl-2">);</span><br/><span class="hl-2">      </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-8">ranking</span><span class="hl-2">(</span><span class="hl-5">group</span><span class="hl-2">);</span><br/><span class="hl-2">      </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">group</span><span class="hl-2">);</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">404</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">();</span><br/><span class="hl-2">  } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">({</span><span class="hl-5">error:</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2">.</span><span class="hl-5">message</span><span class="hl-2">});</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Modify a group in the database using its ID</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">groupRouter</span><span class="hl-2">.</span><span class="hl-8">patch</span><span class="hl-2">(</span><span class="hl-6">&#39;/:id&#39;</span><span class="hl-2">, </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">allowedUpdates</span><span class="hl-2"> = [</span><span class="hl-6">&#39;name&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;members&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;groupStats&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;favoriteTracks&#39;</span><span class="hl-2">, </span><span class="hl-6">&#39;trackHistory&#39;</span><span class="hl-2">];</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">actualUpdates</span><span class="hl-2"> = </span><span class="hl-5">Object</span><span class="hl-2">.</span><span class="hl-8">keys</span><span class="hl-2">(</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">body</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">isValidUpdate</span><span class="hl-2"> = </span><span class="hl-5">actualUpdates</span><span class="hl-2">.</span><span class="hl-8">every</span><span class="hl-2">((</span><span class="hl-5">update</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> </span><span class="hl-5">allowedUpdates</span><span class="hl-2">.</span><span class="hl-8">includes</span><span class="hl-2">(</span><span class="hl-5">update</span><span class="hl-2">));</span><br/><br/><span class="hl-2">  </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">isValidUpdate</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">400</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-5">error:</span><span class="hl-2"> </span><span class="hl-6">&#39;Update is not permitted&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">    });</span><br/><span class="hl-2">  }</span><br/><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">group</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">Group</span><span class="hl-2">.</span><span class="hl-8">findByIdAndUpdate</span><span class="hl-2">(</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">params</span><span class="hl-2">.</span><span class="hl-5">id</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">body</span><span class="hl-2">,</span><br/><span class="hl-2">    {</span><br/><span class="hl-2">      </span><span class="hl-5">new:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-5">runValidators:</span><span class="hl-2"> </span><span class="hl-3">true</span><span class="hl-2">,</span><br/><span class="hl-2">    });</span><br/><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-5">group</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-8">checkItemsExists</span><span class="hl-2">(</span><span class="hl-5">group</span><span class="hl-2">);</span><br/><span class="hl-2">      </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-8">updateStats</span><span class="hl-2">(</span><span class="hl-5">group</span><span class="hl-2">);</span><br/><span class="hl-2">      </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-8">ranking</span><span class="hl-2">(</span><span class="hl-5">group</span><span class="hl-2">);</span><br/><span class="hl-2">      </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">group</span><span class="hl-2">);</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">404</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">();</span><br/><span class="hl-2">  } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">({</span><span class="hl-5">error:</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2">.</span><span class="hl-5">message</span><span class="hl-2">});</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Delete a group in the database using its name as query string</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">groupRouter</span><span class="hl-2">.</span><span class="hl-8">delete</span><span class="hl-2">(</span><span class="hl-6">&#39;/&#39;</span><span class="hl-2">, </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">query</span><span class="hl-2">.</span><span class="hl-5">name</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">400</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-5">error:</span><span class="hl-2"> </span><span class="hl-6">&#39;A group name must be provided&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">    });</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">group</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">Group</span><span class="hl-2">.</span><span class="hl-8">findOneAndDelete</span><span class="hl-2">({</span><br/><span class="hl-2">      </span><span class="hl-5">name:</span><span class="hl-2"> </span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">query</span><span class="hl-2">.</span><span class="hl-5">name</span><span class="hl-2">.</span><span class="hl-8">toString</span><span class="hl-2">(),</span><br/><span class="hl-2">    });</span><br/><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">group</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">404</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">();</span><br/><span class="hl-2">    } </span><span class="hl-1">else</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">group</span><span class="hl-2">);</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">error</span><span class="hl-2">);</span><br/><span class="hl-2">  }  </span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">/**</span><br/><span class="hl-0"> * Delete a group in the database using its ID</span><br/><span class="hl-0"> */</span><br/><span class="hl-5">groupRouter</span><span class="hl-2">.</span><span class="hl-8">delete</span><span class="hl-2">(</span><span class="hl-6">&#39;/:id&#39;</span><span class="hl-2">, </span><span class="hl-3">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-3">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-1">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">const</span><span class="hl-2"> </span><span class="hl-7">group</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">Group</span><span class="hl-2">.</span><span class="hl-8">findByIdAndDelete</span><span class="hl-2">(</span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">params</span><span class="hl-2">.</span><span class="hl-5">id</span><span class="hl-2">);</span><br/><br/><span class="hl-2">    </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-5">group</span><span class="hl-2">) {</span><br/><span class="hl-2">      </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">404</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">();</span><br/><span class="hl-2">    } </span><span class="hl-1">else</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">group</span><span class="hl-2">);</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  } </span><span class="hl-1">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-8">status</span><span class="hl-2">(</span><span class="hl-12">500</span><span class="hl-2">).</span><span class="hl-8">send</span><span class="hl-2">(</span><span class="hl-5">error</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">});</span>
</code></pre>
<p>La primera función que nos encontramos en <em>Groups</em> es <em>updateStats</em>, que se encarga de actualizar las estadísticas del grupo. Para ello, se recorre el array de miembros del grupo y se van sumando las estadísticas de cada uno de ellos. Una vez se han sumado todas las estadísticas, se actualizan las estadísticas del grupo. Si alguno de los miembros no existe, se lanza un error.
<br><br>A continuación tenemos <em>ranking</em>, que se encarga de actualizar el ranking del grupo. Para ello, se recorre el array de miembros del grupo y se van sumando los puntos de cada uno de ellos, tanto por distancia como por elevación. Una vez se han sumado todos los puntos, se ordena el array de miembros del grupo según la puntuación obtenida, y nos quedan los dos arrays ordenados de mayor a menor. Si alguno de los miembros no existe, se lanza un error.
<br><br>También tenemos <em>checkItemsExists</em>, que se encarga de comprobar que 
los usuarios del grupo y las rutas favoritas del grupo existen en la base de datos. Si alguno de ellos no existe, se lanza un error.
<br><br>Por último, tenemos las operaciones a través de los métodos HTTP:</p>
<ul>
<li><em>GET /groups</em>: Consulta todos los grupos de la base de datos. Si usamos el query string <em>name</em> devuelve el grupo con ese nombre.</li>
<li><em>GET /groups/:id</em>: Consulta un grupo de la base de datos a través de su ID.</li>
<li><em>POST /groups</em>: Crea un grupo en la base de datos.</li>
<li><em>PATCH /groups</em>: Modifica un grupo en la base de datos a través de su nombre.</li>
<li><em>PATCH /groups/:id</em>: Modifica un grupo en la base de datos a través de su ID.</li>
<li><em>DELETE /groups</em>: Elimina un grupo de la base de datos a través de su nombre.</li>
<li><em>DELETE /groups/:id</em>: Elimina un grupo de la base de datos a través de su ID.
<br><br>Las pruebas llevadas a cabo para <em>Group</em> son las siguientes:</li>
</ul>
<pre><code><span class="hl-7">POST</span><span class="hl-2"> /</span><span class="hl-5">groups</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-5">create</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-3">new</span><span class="hl-2"> </span><span class="hl-8">group</span><span class="hl-2"> (48</span><span class="hl-5">ms</span><span class="hl-2">)</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">when</span><span class="hl-2"> </span><span class="hl-5">creating</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">group</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">name</span><span class="hl-2"> </span><span class="hl-5">is</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">according</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-8">validator</span><span class="hl-2"> (</span><span class="hl-5">Uso</span><span class="hl-2"> </span><span class="hl-5">characters</span><span class="hl-2"> </span><span class="hl-5">that</span><span class="hl-2"> </span><span class="hl-5">are</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">alphanumeric</span><span class="hl-2">)</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">when</span><span class="hl-2"> </span><span class="hl-5">creating</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">group</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">users</span><span class="hl-2"> </span><span class="hl-3">in</span><span class="hl-2"> </span><span class="hl-5">members</span><span class="hl-2"> </span><span class="hl-5">are</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-3">in</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">database</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">when</span><span class="hl-2"> </span><span class="hl-5">creating</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">group</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">tracks</span><span class="hl-2"> </span><span class="hl-3">in</span><span class="hl-2"> </span><span class="hl-5">favoriteTracks</span><span class="hl-2"> </span><span class="hl-5">are</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-3">in</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">database</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">when</span><span class="hl-2"> </span><span class="hl-5">creating</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">group</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">tracks</span><span class="hl-2"> </span><span class="hl-3">in</span><span class="hl-2"> </span><span class="hl-5">trackHistory</span><span class="hl-2"> </span><span class="hl-5">are</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-3">in</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">database</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">when</span><span class="hl-2"> </span><span class="hl-5">creating</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">group</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">group</span><span class="hl-2"> </span><span class="hl-5">name</span><span class="hl-2"> </span><span class="hl-5">doesn</span><span class="hl-6">&#39;t start by a capital lette</span><span class="hl-14">r</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">when</span><span class="hl-2"> </span><span class="hl-5">creating</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">group</span><span class="hl-2">, </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">invalid</span><span class="hl-2"> </span><span class="hl-5">path</span><br/><br/><span class="hl-2">  </span><span class="hl-7">GET</span><span class="hl-2"> /</span><span class="hl-5">groups</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-5">consult</span><span class="hl-2"> </span><span class="hl-5">all</span><span class="hl-2"> </span><span class="hl-5">groups</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-5">consult</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">specific</span><span class="hl-2"> </span><span class="hl-5">group</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-5">consult</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">specific</span><span class="hl-2"> </span><span class="hl-5">group</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">find</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">group</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">find</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">group</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">ge</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">invlid</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><br/><span class="hl-2">  </span><span class="hl-7">PATCH</span><span class="hl-2"> /</span><span class="hl-5">groups</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-5">modify</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">group</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-5">modify</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">user</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">find</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">group</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">modify</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">find</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">group</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">modify</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">400</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">provide</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">group</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">400</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">update</span><span class="hl-2"> </span><span class="hl-5">is</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">permited</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">400</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">the</span><span class="hl-2"> </span><span class="hl-5">update</span><span class="hl-2"> </span><span class="hl-5">is</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">permited</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-1">do</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">invalid</span><span class="hl-2"> </span><span class="hl-5">modification</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-8">name</span><span class="hl-2"> (</span><span class="hl-5">The</span><span class="hl-2"> </span><span class="hl-5">group</span><span class="hl-2"> </span><span class="hl-5">name</span><span class="hl-2"> </span><span class="hl-5">must</span><span class="hl-2"> </span><span class="hl-5">start</span><span class="hl-2"> </span><span class="hl-5">with</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">capital</span><span class="hl-2"> </span><span class="hl-5">letter</span><span class="hl-2">)</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-1">do</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">invalid</span><span class="hl-2"> </span><span class="hl-5">modification</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-8">ID</span><span class="hl-2"> (</span><span class="hl-5">The</span><span class="hl-2"> </span><span class="hl-5">group</span><span class="hl-2"> </span><span class="hl-5">name</span><span class="hl-2"> </span><span class="hl-5">must</span><span class="hl-2"> </span><span class="hl-5">start</span><span class="hl-2"> </span><span class="hl-5">with</span><span class="hl-2"> </span><span class="hl-5">a</span><span class="hl-2"> </span><span class="hl-5">capital</span><span class="hl-2"> </span><span class="hl-5">letter</span><span class="hl-2">)</span><br/><br/><span class="hl-2">  </span><span class="hl-7">DELETE</span><span class="hl-2"> /</span><span class="hl-5">groups</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-3">delete</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">group</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-5">successfully</span><span class="hl-2"> </span><span class="hl-3">delete</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">group</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">find</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">group</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-3">delete</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-5">name</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">404</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-5">not</span><span class="hl-2"> </span><span class="hl-5">find</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">group</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-3">delete</span><span class="hl-2"> </span><span class="hl-5">by</span><span class="hl-2"> </span><span class="hl-7">ID</span><br/><span class="hl-2">    ✔ </span><span class="hl-5">Should</span><span class="hl-2"> </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-12">500</span><span class="hl-2"> </span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-5">due</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-1">try</span><span class="hl-2"> </span><span class="hl-5">to</span><span class="hl-2"> </span><span class="hl-3">delete</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">group</span><span class="hl-2"> </span><span class="hl-1">with</span><span class="hl-2"> </span><span class="hl-5">an</span><span class="hl-2"> </span><span class="hl-5">invalid</span><span class="hl-2"> </span><span class="hl-7">ID</span>
</code></pre>

<a href="#despliegue-de-la-api-en-cyclic-y-mongodb-atlas" id="despliegue-de-la-api-en-cyclic-y-mongodb-atlas" style="color: inherit; text-decoration: none;">
  <h2>Despliegue de la API en cyclic y MongoDB Atlas</h2>
</a>
<p>Para llevar a cabo el despliegue, lo primero es crear un clúster en MongoDB Atlas, en cuyo sitio web nos debemos de registrar previamente, para realizar esta parte correctamente se han seguido los apuntes sobre dicho tema. Una vez creado el clúster con un determinado usuario y contraseña obtendremos la URL de la conexión al clúster, que en nuestro caso es la siguiente:</p>
<pre><code><span class="hl-5">mongodb</span><span class="hl-2">+</span><span class="hl-15">srv</span><span class="hl-2">:</span><span class="hl-0">//DSI-API:dsiapi@cluster0.2my5da6.mongodb.net/destravate-app</span>
</code></pre>
<p>A continuación llevamos a cabo el despliegue en sí, en Cylic, donde también se han seguido los pasos indicados por el profesor para llevarlo a cabo. Tras registrarnos debemos de incluir el repositorio donde se encuentra nuestra aplicación y para vincularla a la base de datos de MongoDB Atlas debemos de definir la variable de entorno <em>MONGODB_URL</em> con la URL que habíamos obtenido anteriormente. Una vez hecho esto podremos ver en la pestaña <em>logs</em> cómo se ha conectado correctamente y obtendremos una URL por la cual podremos llevar a cabo las peticiones en nuestro caso es la siguiente:</p>
<pre><code><span class="hl-15">https</span><span class="hl-2">:</span><span class="hl-0">//lively-ox-cowboy-hat.cyclic.app/</span>
</code></pre>

<a href="#conclusión" id="conclusión" style="color: inherit; text-decoration: none;">
  <h2>Conclusión</h2>
</a>
<p>Con la realización de este proyecto hemos aprendido a crear nuestra propia API REST, lo cual es fundamental en el desarrollo de aplicaciones, permitiendo que diferentes sistemas y aplicaciones se comuniquen de manera eficiente. También cómo se relaciona esta con una base de datos, en nuestro caso mongoose, donde hemos implementado las 4 funciones basicas (inserción, consulta, borrado y modificación). También hemos mejorado el uso de promesas implementado el uso de async/await, lo que nos permite trabajar con código asíncrono de manera más legible. Además, hemos podido consolidar los conocimientos relacionados con el servidor Express y el uso de las peticiones HTTP para llevar a cabo las operaciones anteriormente mencionadas (POST, GET, DELETE, PATCH).
<br><br>Tras todo el trabajo de desarrollo de la API-REST, documentación, pruebas, etc hemos realizado el despliegue, una parte que consideramos de gran valor, ya que nos permite ver nuestra aplicación en funcionamiento y cómo se relaciona con una base de datos en la nube (MonboDB Atlas) que configuramos anteriormente.
<br><br>En esta práctica tuvimos que realizar ciertas modificaciones en los workflows para conseguir que funcionara correctamente los flujos de trabajo con acciones de GitHub para integración continua, tanto para los tests, coveralls y sonar-cloud, tras los cambios pertinentes todo funciona correctamente, consiguiendo los siguientes <em>badgets</em>:</p>
<ul>
<li>Tests: <a href="https://github.com/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-groupo/actions/workflows/node.js.yml"><img src="https://github.com/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-groupo/actions/workflows/node.js.yml/badge.svg" alt="Tests"></a></li>
<li>Coveralls: <a href="https://coveralls.io/github/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-groupo?branch=main"><img src="https://coveralls.io/repos/github/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-groupo/badge.svg?branch=main" alt="Coverage Status"></a></li>
<li>Sonar-Cloud: <a href="https://sonarcloud.io/summary/new_code?id=ULL-ESIT-INF-DSI-2223_ull-esit-inf-dsi-22-23-prct12-destravate-api-groupo"><img src="https://sonarcloud.io/api/project_badges/measure?project=ULL-ESIT-INF-DSI-2223_ull-esit-inf-dsi-22-23-prct12-destravate-api-groupo&metric=alert_status" alt="Quality Gate Status"></a></li>
</ul>

<a href="#bibliografía" id="bibliografía" style="color: inherit; text-decoration: none;">
  <h2>Bibliografía</h2>
</a>
<p>Para la realización de esta práctica se han consultado las siguientes fuentes bibliográficas:</p>
<ul>
<li><a href="https://ull-esit-inf-dsi-2223.github.io/prct12-destravate-api/">Guion de la práctica 12</a></li>
<li><a href="https://ull-esit-inf-dsi-2223.github.io/nodejs-theory/nodejs-rest-api.html">Apuntes API REST</a></li>
<li><a href="https://ull-esit-inf-dsi-2223.github.io/nodejs-theory/nodejs-rest-api-async-await.html">Apuntes Async/Await</a></li>
<li><a href="https://ull-esit-inf-dsi-2223.github.io/nodejs-theory/nodejs-rest-api-testing.html">Apuntes Pruebas en la API REST</a></li>
<li><a href="https://ull-esit-inf-dsi-2223.github.io/nodejs-theory/nodejs-deployment.html">Apuntes Despliegue del API REST</a></li>
</ul>
</div></div>
<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
<div class="tsd-navigation settings">
<details class="tsd-index-accordion"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Settings</h3></summary>
<div class="tsd-accordion-details">
<div class="tsd-filter-visibility">
<h4 class="uppercase">Member Visibility</h4><form>
<ul id="tsd-filter-options">
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div>
<div class="tsd-theme-toggle">
<h4 class="uppercase">Theme</h4><select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div>
<nav class="tsd-navigation primary">
<details class="tsd-index-accordion" open><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Modules</h3></summary>
<div class="tsd-accordion-details">
<ul>
<li class="current selected"><a href="modules.html">practica-<wbr/>12</a>
<ul>
<li class="tsd-kind-module"><a href="modules/models_challenge.html">models/challenge</a></li>
<li class="tsd-kind-module"><a href="modules/models_group.html">models/group</a></li>
<li class="tsd-kind-module"><a href="modules/models_track.html">models/track</a></li>
<li class="tsd-kind-module"><a href="modules/models_user.html">models/user</a></li>
<li class="tsd-kind-module"><a href="modules/routers_challenge.html">routers/challenge</a></li>
<li class="tsd-kind-module"><a href="modules/routers_group.html">routers/group</a></li>
<li class="tsd-kind-module"><a href="modules/routers_track.html">routers/track</a></li>
<li class="tsd-kind-module"><a href="modules/routers_user.html">routers/user</a></li></ul></li></ul></div></details></nav></div></div>
<div class="container tsd-generator">
<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div>
<div class="overlay"></div><script src="assets/main.js"></script></body></html>